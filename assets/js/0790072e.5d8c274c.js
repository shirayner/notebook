"use strict";(self.webpackChunknotebook=self.webpackChunknotebook||[]).push([[837],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(67294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function r(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},l=Object.keys(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)t=l[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var i=a.createContext({}),p=function(e){var n=a.useContext(i),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(i.Provider,{value:n},e.children)},m="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},u=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,l=e.originalType,i=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),m=p(t),u=o,k=m["".concat(i,".").concat(u)]||m[u]||d[u]||l;return t?a.createElement(k,s(s({ref:n},c),{},{components:t})):a.createElement(k,s({ref:n},c))}));function k(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var l=t.length,s=new Array(l);s[0]=u;var r={};for(var i in n)hasOwnProperty.call(n,i)&&(r[i]=n[i]);r.originalType=e,r[m]="string"==typeof e?e:o,s[1]=r;for(var p=2;p<l;p++)s[p]=t[p];return a.createElement.apply(null,s)}return a.createElement.apply(null,t)}u.displayName="MDXCreateElement"},10060:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>r,toc:()=>p});var a=t(87462),o=(t(67294),t(3905));const l={sidebar_label:"\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",tags:["JVM"]},s="Java\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",r={unversionedId:"Backend/Java/Jvm/\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",id:"Backend/Java/Jvm/\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",title:"Java\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",description:"[toc]",source:"@site/docs/03-Backend/01-Java/04-Jvm/02_\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790.md",sourceDirName:"03-Backend/01-Java/04-Jvm",slug:"/Backend/Java/Jvm/\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",permalink:"/notebook/docs/Backend/Java/Jvm/\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",draft:!1,editUrl:"https://github.com/shirayner/notebook/tree/master/docs/03-Backend/01-Java/04-Jvm/02_\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790.md",tags:[{label:"JVM",permalink:"/notebook/docs/tags/jvm"}],version:"current",sidebarPosition:2,frontMatter:{sidebar_label:"\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790",tags:["JVM"]},sidebar:"backendSideBar",previous:{title:"\u6838\u5fc3\u77e5\u8bc6\u70b9\u56fe\u89e3",permalink:"/notebook/docs/Backend/Java/Jvm/\u6838\u5fc3\u77e5\u8bc6\u70b9\u56fe\u89e3"},next:{title:"\u6027\u80fd\u76d1\u63a7\u4e0e\u5206\u6790\u5de5\u5177",permalink:"/notebook/docs/Backend/Java/Jvm/\u6027\u80fd\u76d1\u63a7\u4e0e\u5206\u6790\u5de5\u5177"}},i={},p=[{value:"\u63a8\u8350\u9605\u8bfb",id:"\u63a8\u8350\u9605\u8bfb",level:2},{value:"\u4e00\u3001\u73af\u5883\u8bf4\u660e",id:"\u4e00\u73af\u5883\u8bf4\u660e",level:2},{value:"\u4e8c\u3001JSR 269 \u5165\u95e8\u793a\u4f8b",id:"\u4e8cjsr-269-\u5165\u95e8\u793a\u4f8b",level:2},{value:"1.JSR 269 \u6982\u8ff0",id:"1jsr-269-\u6982\u8ff0",level:3},{value:"2.\u901a\u8fc7\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u5b9e\u73b0\u7b80\u6613\u7684 Lombok",id:"2\u901a\u8fc7\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u5b9e\u73b0\u7b80\u6613\u7684-lombok",level:3},{value:"3.MapStruct \u4f7f\u7528\u5165\u95e8",id:"3mapstruct-\u4f7f\u7528\u5165\u95e8",level:3},{value:"\u4e09\u3001Javac \u7f16\u8bd1\u6982\u8ff0",id:"\u4e09javac-\u7f16\u8bd1\u6982\u8ff0",level:2},{value:"1.\u6982\u8ff0",id:"1\u6982\u8ff0",level:3},{value:"2.\u7f16\u8bd1\u7684\u5165\u53e3",id:"2\u7f16\u8bd1\u7684\u5165\u53e3",level:3},{value:"3.\u7f16\u8bd1\u671f Debug",id:"3\u7f16\u8bd1\u671f-debug",level:3},{value:"\u56db\u3001JavaC \u7f16\u8bd1\u5668\u6e90\u7801\u5206\u6790",id:"\u56dbjavac-\u7f16\u8bd1\u5668\u6e90\u7801\u5206\u6790",level:2},{value:"1.\u89e3\u6790\u4e0e\u586b\u5145\u7b26\u53f7\u8868",id:"1\u89e3\u6790\u4e0e\u586b\u5145\u7b26\u53f7\u8868",level:3},{value:"1.1 \u8bcd\u6cd5\u5206\u6790",id:"11-\u8bcd\u6cd5\u5206\u6790",level:4},{value:"1.2 Javac \u62bd\u8c61\u8bed\u6cd5\u6811",id:"12-javac-\u62bd\u8c61\u8bed\u6cd5\u6811",level:4},{value:"1.3 \u8bed\u6cd5\u5206\u6790",id:"13-\u8bed\u6cd5\u5206\u6790",level:4},{value:"1.4 \u586b\u5145\u7b26\u53f7\u8868",id:"14-\u586b\u5145\u7b26\u53f7\u8868",level:4},{value:"1.4.1 \u7b26\u53f7\u8868\u7684\u6570\u636e\u7ed3\u6784",id:"141-\u7b26\u53f7\u8868\u7684\u6570\u636e\u7ed3\u6784",level:5},{value:"1.4.2 \u7b26\u53f7\u8868\u7684\u586b\u5145\u8fc7\u7a0b",id:"142-\u7b26\u53f7\u8868\u7684\u586b\u5145\u8fc7\u7a0b",level:5},{value:"2.\u6ce8\u89e3\u5904\u7406",id:"2\u6ce8\u89e3\u5904\u7406",level:3},{value:"2.1 \u6ce8\u89e3\u5904\u7406\u65f6\u5e8f\u56fe",id:"21-\u6ce8\u89e3\u5904\u7406\u65f6\u5e8f\u56fe",level:4},{value:"2.2 \u83b7\u53d6\u6ce8\u89e3\u5904\u7406\u5668",id:"22-\u83b7\u53d6\u6ce8\u89e3\u5904\u7406\u5668",level:4},{value:"2.3 \u83b7\u53d6\u6ce8\u89e3\u4e0e\u5904\u7406\u6ce8\u89e3",id:"23-\u83b7\u53d6\u6ce8\u89e3\u4e0e\u5904\u7406\u6ce8\u89e3",level:4},{value:"3. \u8bed\u4e49\u5206\u6790\u4e0e\u5b57\u8282\u7801\u751f\u6210",id:"3-\u8bed\u4e49\u5206\u6790\u4e0e\u5b57\u8282\u7801\u751f\u6210",level:3}],c={toc:p},m="wrapper";function d(e){let{components:n,...l}=e;return(0,o.kt)(m,(0,a.Z)({},c,l,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"java\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790"},"Java\u7f16\u8bd1\u5668\u6e90\u7801\u89e3\u6790"),(0,o.kt)("p",null,"[toc]"),(0,o.kt)("h2",{id:"\u63a8\u8350\u9605\u8bfb"},"\u63a8\u8350\u9605\u8bfb"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://65.49.135.49/geek/geek/144-%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AE%9E%E6%88%98%E8%AF%BE/10%E4%B8%A8Java%E7%BC%96%E8%AF%91%E5%99%A8%EF%BC%88%E4%BA%8C%EF%BC%89%EF%BC%9A%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%E4%B9%8B%E5%90%8E%EF%BC%8C%E8%BF%98%E8%A6%81%E5%81%9A%E4%BA%9B%E4%BB%80%E4%B9%88%EF%BC%9F.html"},"10 | Java \u7f16\u8bd1\u5668\uff08\u4e8c\uff09\uff1a\u8bed\u6cd5\u5206\u6790\u4e4b\u540e\uff0c\u8fd8\u8981\u505a\u4e9b\u4ec0\u4e48\uff1f")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://item.jd.com/1069428318.html"},"\u300a\u6df1\u5165\u7406\u89e3 JVM \u865a\u62df\u673a\u300b")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://item.jd.com/12794094.html"},"\u300a\u6df1\u5165\u89e3\u6790 Java \u7f16\u8bd1\u5668\u300b")))),(0,o.kt)("h2",{id:"\u4e00\u73af\u5883\u8bf4\u660e"},"\u4e00\u3001\u73af\u5883\u8bf4\u660e"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"jdk: open-jdk-16"))),(0,o.kt)("p",null,"\u6700\u5f00\u59cb\u662f\u7528 JDK1.8\uff0c\u4f46\u662f Debug \u7684\u65f6\u5019\u53ea\u80fd\u770b\u5230\u53cd\u7f16\u8bd1\u540e\u7684\u4ee3\u7801\uff0c\u592a\u75db\u82e6\u4e86\uff0c\u800c\u5728 jdk9 \u6a21\u5757\u5316\u4e4b\u540e\uff0ctools.jar \u5305\u88ab\u653e\u8fdb\u4e86 java \u7684\u6e90\u7801\u5305\u4e0b\uff0c\u6240\u4ee5\u4e3a\u4e86\u65b9\u4fbf\u770b\u6e90\u7801 Debug\uff0c\u540e\u6765\u53c8\u5c06 jdk \u6539\u6210\u4e86 open-jdk-16\u3002"),(0,o.kt)("h2",{id:"\u4e8cjsr-269-\u5165\u95e8\u793a\u4f8b"},"\u4e8c\u3001JSR 269 \u5165\u95e8\u793a\u4f8b"),(0,o.kt)("p",null,"\u6211\u4eec\u5148\u6765\u770b\u4e24\u4e2a JSR269 \u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u7684\u793a\u4f8b\uff0c\u56e0\u4e3a\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u662f\u5728\u7f16\u8bd1\u65f6\u8fdb\u884c\u7684\uff0c\u53ef\u4ee5\u5148\u53c8\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u7684\u4f7f\u7528\u8fc7\u6e21\u5230\u7f16\u8bd1\u6d41\u7a0b\u5206\u6790\u3002"),(0,o.kt)("p",null,"\u63a8\u8350\u9605\u8bfb\uff1a"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://jcp.org/en/jsr/detail?id=269"},"https://jcp.org/en/jsr/detail?id=269")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://lilu.org.cn/2020/12/19/javaee/lombok/impl-simple-lombok/"},"\u52a8\u624b\u5b9e\u73b0 Lombok")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://liuyehcf.github.io/2018/02/02/Java-JSR-269-%E6%8F%92%E5%85%A5%E5%BC%8F%E6%B3%A8%E8%A7%A3%E5%A4%84%E7%90%86%E5%99%A8/"},"Java-JSR-269-\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://nicky-chin.cn/2019/05/03/apt_lombok_implement/"},"\u57fa\u4e8e APT(\u6ce8\u89e3\u5904\u7406\u5668)\u5b9e\u73b0 Lombok \u7684@getter @setter @toString \u529f\u80fd")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://mouse0w0.github.io/2018/11/28/Introduce-to-Pluggable-Annotation-Processing-API/"},"\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406 API\uff08JSR269\uff09\u4ecb\u7ecd")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://blog.csdn.net/justry_deng/article/details/106176181"},"\u3010JSR269 \u5b9e\u6218\u3011\u4e4b\u7f16\u8bd1\u65f6\u64cd\u4f5c AST\uff0c\u4fee\u6539\u5b57\u8282\u7801\u6587\u4ef6\uff0c\u4ee5\u5b9e\u73b0\u548c lombok \u7c7b\u4f3c\u7684\u529f\u80fd")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"http://pfmiles.github.io/blog/dynamic-java/"},"\u52a8\u6001\u7684 Java - \u65e0\u5e9f\u8bdd JavaCompilerAPI \u4e2d\u6587\u6307\u5357")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.cnblogs.com/wade-luffy/p/6050331.html"},"Javac \u65e9\u671f(\u7f16\u8bd1\u671f)")))),(0,o.kt)("h3",{id:"1jsr-269-\u6982\u8ff0"},"1.JSR 269 \u6982\u8ff0"),(0,o.kt)("p",null,"Java \u5728 JDK1.5 \u7248\u672c\u4e2d\u63d0\u4f9b\u4e86\u5bf9\u6ce8\u89e3\uff08Annotation\uff09\u7684\u652f\u6301\uff0c\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u5148\u5b9a\u4e49\u5e76\u4f7f\u7528\u6ce8\u89e3\uff0c\u7136\u540e\u5728\u8fd0\u884c\u671f\u901a\u8fc7\u53cd\u5c04\u83b7\u53d6\u6ce8\u89e3\u4fe1\u606f\u6765\u8fdb\u884c\u6ce8\u89e3\u5904\u7406\u3002"),(0,o.kt)("p",null,"\u800c\u540e\u5728 JDK1.6 \u7248\u672c\u4e2d\u53c8\u63d0\u4f9b\u4e86\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406 API\uff08PluggableAnnotationProcessingAPI\uff09\uff08JSR269\uff09\uff0c\u4ece\u6b64\u6211\u4eec\u4fbf\u53ef\u4ee5\u5148\u5b9a\u4e49\u5e76\u4f7f\u7528\u6ce8\u89e3\uff0c\u7136\u540e\u7531 Java \u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u671f\u8c03\u7528\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u6ce8\u89e3\u5904\u7406\u5668\u6765\u8fdb\u884c\u6ce8\u89e3\u5904\u7406\u3002"),(0,o.kt)("p",null,"\u6ce8\u89e3\u5904\u7406\u5668\u76f8\u5f53\u4e8e Java \u7f16\u8bd1\u5668\u7559\u7ed9\u6211\u4eec\u7684\u4e00\u4e2a\u7f16\u8bd1\u65f6\u7684\u6269\u5c55\u70b9\uff0c\u76f8\u5f53\u4e8e Java \u7f16\u8bd1\u5668\u7684\u4e00\u4e2a\u63d2\u4ef6\uff0c\u56e0\u6b64\u79f0\u4e3a\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\uff0c\u5b83\u662f\u5728\u7f16\u8bd1\u671f\u6267\u884c\u7684\uff0c\u6240\u4ee5\u5e76\u4e0d\u9700\u8981 Java \u865a\u62df\u673a\u7684\u53c2\u4e0e\u3002"),(0,o.kt)("p",null,"\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u662f\u5728\u7f16\u8bd1\u65f6\u901a\u8fc7 Java \u63d0\u4f9b\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"java.util.ServiceLoader"),"\u5de5\u5177\u7c7b\u6765\u52a0\u8f7d\u7684\u3002"),(0,o.kt)("p",null,"ServiceLoader \u4f1a\u52a0\u8f7d",(0,o.kt)("inlineCode",{parentName:"p"},"resources/META-INF/services"),"\u76ee\u5f55\u4e0b\u7684\u63a5\u53e3\u6587\u4ef6\uff0c\u63a5\u53e3\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u4e3a\u63a5\u53e3\u5168\u7c7b\u540d\uff0c\u6587\u4ef6\u5185\u5bb9\u662f\u63a5\u53e3\u7684\u5b9e\u73b0\u7c7b\u7684\u5168\u7c7b\u540d\u5217\u8868\u3002\u4f8b\u5982\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210611203230999",src:t(28866).Z,width:"397",height:"141"})),(0,o.kt)("p",null,"\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u7684\u63a5\u53e3\u4e3a",(0,o.kt)("inlineCode",{parentName:"p"},"javax.annotation.processing.Processor"),"\uff0c\u800c\u6211\u4eec\u81ea\u5b9a\u4e49\u7684\u6ce8\u89e3\u5904\u7406\u5668",(0,o.kt)("inlineCode",{parentName:"p"},"com.ray.study.sample.simple.lombok.annotation.processor.DataAnnotationProcessor"),"\u5c31\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u63a5\u53e3"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210611203331036",src:t(40538).Z,width:"629",height:"53"})),(0,o.kt)("h3",{id:"2\u901a\u8fc7\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u5b9e\u73b0\u7b80\u6613\u7684-lombok"},"2.\u901a\u8fc7\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u5b9e\u73b0\u7b80\u6613\u7684 Lombok"),(0,o.kt)("p",null,"Lombok \u5c31\u662f\u501f\u52a9\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\u6765\u5b9e\u73b0\u7684\uff0c\u4ee5\u4e0b\u5de5\u7a0b\u4f7f\u7528 JSR269 \u63d2\u5165\u5f0f\u6ce8\u89e3\u5b9e\u73b0\u4e86 Lombok \u751f\u6210 Getter/Setter \u65b9\u6cd5\u7684\u5de5\u5177\uff1a"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u6e90\u7801\uff1a",(0,o.kt)("a",{parentName:"p",href:"https://github.com/shirayner/jsr269-in-action"},"shirayner/jsr269-in-action"))),(0,o.kt)("h3",{id:"3mapstruct-\u4f7f\u7528\u5165\u95e8"},"3.MapStruct \u4f7f\u7528\u5165\u95e8"),(0,o.kt)("p",null,"\u6211\u4eec\u5148\u6765\u770b\u4e00\u4e0b MapStruct \u7684\u4f7f\u7528\u5165\u95e8\uff0c\u53ef\u89c1\u5982\u4e0b\u5de5\u7a0b\uff1a"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"\u6e90\u7801\uff1a",(0,o.kt)("a",{parentName:"li",href:"https://github.com/shirayner/spring-boot-sample/tree/master/sample-beanmap/sample-beanmap-mapstruct"},"shirayner/spring-boot-sample/sample-beanmap-mapstruct")),(0,o.kt)("li",{parentName:"ul"},"\u6559\u7a0b\uff1a"))),(0,o.kt)("p",null,"\u4e0b\u6587\u7684 Java \u7f16\u8bd1\u5668\u7684\u6e90\u7801\u5206\u6790\u5c31\u662f\u57fa\u4e8e MapStruct \u7684\u4f7f\u7528\u5165\u95e8\u7684\u5de5\u7a0b\u6765\u8fdb\u884c\u7684\uff08\u8fd9\u662f\u7531\u4e8e\u5f53\u65f6\u6b63\u5728\u8fdb\u884c MapStruct \u7684\u6e90\u7801\u5206\u6790\uff0c\u800c\u8fd9\u5c31\u81ea\u7136\u800c\u7136\u5730\u5ef6\u4f38\u5230\u4e86 Java \u7f16\u8bd1\u5668\u5206\u6790\uff0c\u4e8e\u662f\u5c31\u6709\u4e86\u8fd9\u4e24\u7bc7\u6587\u7ae0\uff09\u3002"),(0,o.kt)("h2",{id:"\u4e09javac-\u7f16\u8bd1\u6982\u8ff0"},"\u4e09\u3001Javac \u7f16\u8bd1\u6982\u8ff0"),(0,o.kt)("h3",{id:"1\u6982\u8ff0"},"1.\u6982\u8ff0"),(0,o.kt)("img",{src:"https://www.plantuml.com/plantuml/png/RPFHIW9158Rlvoa6x-q1l0X5AWmYBto1OPriOvsLcIs8wA98Kz4oY2IAJ8eKBBmGB2JePPpTxIsQdNLrTjkvEfpp_-ViTsOspIn4hSEo0VPq0yF4sW4wGWc86FI2JP4B2fg169CL6Icb-Qpb_Zpm-jH-dF7xeVDy9cKxIDlN2SwQHIp556iM8YNFmHjjPpHslk_SyOrmIFcscATbpN95Q2ay0L0SnU8ENkodplphYlT7l5frtj_uzQVRzxrvH1dEaE86iJ2DEkt9K9ZvwuNJgKbrXX3JGfPkaZmrDSoOJafH4w_N5kC-kcxpN30vjxtvRB1eW8nZEN0B4qoHXS5f2AyziRlJ25wk4C2fqink8QmJYJYT8FYzR0QYdCTPeTYZ5IU43s4okHxF69U4KloF1mJNxxSBNGu8NvKKBDy4J44V2AnIVWjb0Khi5oDlPTbZzHaIIjcD4iTr0CfuhwniB0NzPTgDWTjl0P36f2X-W3y0",alt:null}),(0,o.kt)("p",null,"Java \u8bed\u8a00\u7684\u201c\u7f16\u8bd1\u671f\u201d\u5176\u5b9e\u662f\u4e00\u6bb5\u201c\u4e0d\u786e\u5b9a\u201d\u7684\u64cd\u4f5c\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u5b83\u53ef\u80fd\u662f\u6307\u4e00\u4e2a\u524d\u7aef\u7f16\u8bd1\u5668\uff08\u5176\u5b9e\u53eb\u201c\u7f16\u8bd1\u5668\u7684\u524d\u7aef\u201d\u66f4\u51c6\u786e\u4e00\u4e9b\uff09\u628a",(0,o.kt)("em",{parentName:"p"},".java \u6587\u4ef6\u8f6c\u53d8\u6210"),".class \u6587\u4ef6\u7684\u8fc7\u7a0b\uff1b\u4e5f\u53ef\u80fd\u662f\u6307\u865a\u62df\u673a\u7684\u540e\u7aef\u8fd0\u884c\u671f\u7f16\u8bd1\u5668\uff08JIT \u7f16\u8bd1\u5668\uff0cJust In Time Compiler\uff09\u628a\u5b57\u8282\u7801\u8f6c\u53d8\u6210\u673a\u5668\u7801\u7684\u8fc7\u7a0b\uff1b\u8fd8\u53ef\u80fd\u662f\u6307\u4f7f\u7528\u9759\u6001\u63d0\u524d\u7f16\u8bd1\u5668\uff08AOT \u7f16\u8bd1\u5668\uff0cAhead Of Time Compiler\uff09\u76f4\u63a5\u628a","*",".java \u6587\u4ef6\u7f16\u8bd1\u6210\u672c\u5730\u673a\u5668\u4ee3\u7801\u7684\u8fc7\u7a0b\u3002"),(0,o.kt)("p",null,"\u4e0b\u9762\u5217\u4e3e\u4e86\u8fd9 3 \u7c7b\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u4e00\u4e9b\u6bd4\u8f83\u6709\u4ee3\u8868\u6027\u7684\u7f16\u8bd1\u5668\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"\u524d\u7aef\u7f16\u8bd1\u5668\uff1aSun \u7684 Javac\u3001Eclipse JDT \u4e2d\u7684\u589e\u91cf\u5f0f\u7f16\u8bd1\u5668\uff08ECJ\uff09\u3002"),(0,o.kt)("li",{parentName:"ul"},"JIT \u7f16\u8bd1\u5668\uff1aHotSpot VM \u7684 C1\u3001C2 \u7f16\u8bd1\u5668\u3002"),(0,o.kt)("li",{parentName:"ul"},"AOT \u7f16\u8bd1\u5668\uff1aGNU Compiler for the Java\uff08GCJ\uff09\u3001Excelsior JET\u3002"))),(0,o.kt)("p",null,"Javac \u7f16\u8bd1\u5668\u7684\u7f16\u8bd1\u8fc7\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a"),(0,o.kt)("img",{src:"https://www.plantuml.com/plantuml/png/NL7RIiD047tVhmXzzmTQaFwAe0y5hQBnIGHlgR4rsIXDn0TjGgrPq6fBq5xGl-dCxcSupRebwJuiovbpPiwShH_PMuVsyTukO_cB7T3Li1lxJQkYqZu-1ukf3yaRE8vyVmK-KOceM2VCebELeWDpZlD0nkUr7DhOL9yUPY6uBP9gh0fUk4I_2fpXEWVRlsgSw0B6TqPP7bnZfwne43D17k7bIWQjbIbmdo3jm6s4_1wS0Vpm8WqUnNzlvK-0HxfceD6bx8erkduONja0-LtCRlGYovo63wfzGM78RW_TO6K9uslIO_yCUmEpRpX2xuCq50l5Y7uAxdSf4Hgduv1PPE8ezy_TC5RVQMxJ1_u1",alt:null}),(0,o.kt)("p",null,"\u5728\u679a\u4e3e\u7c7b",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.comp.CompileStates"),"\u4e2d\u5b9a\u4e49\u4e86\u6574\u4e2a\u6d41\u7a0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"\n public enum CompileState {\n        INIT(0),     //\u521d\u59cb\u5316\n        PARSE(1),    //\u8bcd\u6cd5\u548c\u8bed\u6cd5\u5206\u6790\n        ENTER(2),    //\u5efa\u7acb\u7b26\u53f7\u8868\n        PROCESS(3),  //\u5904\u7406\u6ce8\u89e3\n        ATTR(4),     //\u5c5e\u6027\u8ba1\u7b97\n        FLOW(5),     //\u6570\u636e\u6d41\u5206\u6790\n        TRANSTYPES(6),    //\u53bb\u9664\u8bed\u6cd5\u7cd6\uff1a\u6cdb\u578b\u5904\u7406\n        TRANSPATTERNS(7), //\u53bb\u9664\u8bed\u6cd5\u7cd6\uff1a\u6a21\u5f0f\u5339\u914d\u5904\u7406\n        UNLAMBDA(8),      //\u53bb\u9664\u8bed\u6cd5\u7cd6\uff1aLambda\u8868\u8fbe\u5f0f\u5904\u7406(\u8f6c\u6362\u6210\u65b9\u6cd5)\n        LOWER(9),         //\u53bb\u9664\u8bed\u6cd5\u7cd6\uff1a\u5185\u90e8\u7c7b\u3001foreach\u5faa\u73af\u3001\u65ad\u8a00\u7b49\n        GENERATE(10);     //\u751f\u6210\u5b57\u8282\u7801\n }\n")),(0,o.kt)("h3",{id:"2\u7f16\u8bd1\u7684\u5165\u53e3"},"2.\u7f16\u8bd1\u7684\u5165\u53e3"),(0,o.kt)("p",null,"\uff081\uff09\u901a\u8fc7 ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.Main")," \u6765\u7f16\u8bd1 java \u6587\u4ef6"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"\u53c2\u8003\uff1a ",(0,o.kt)("a",{parentName:"li",href:"https://www.cnblogs.com/huaweiyun/p/13071560.html"},"\u7a0b\u5e8f\u5458\u5b9e\u7528 JDK \u5c0f\u5de5\u5177\u5f52\u7eb3\uff0c\u5de5\u4f5c\u7528\u5f97\u5230")))),(0,o.kt)("p",null,"javac \u547d\u4ee4\u662f\u6536\u5f55\u4e8e JDK \u4e2d\u7684 Java \u8bed\u8a00\u7f16\u8bd1\u5668\uff0c\u53ef\u4ee5\u5c06\u540e\u7f00\u540d\u4e3a.java \u7684\u6e90\u6587\u4ef6\u7f16\u8bd1\u4e3a\u540e\u7f00\u540d\u4e3a.class \u7684\u53ef\u4ee5\u8fd0\u884c\u4e8e Java \u865a\u62df\u673a\u7684\u5b57\u8282\u7801\u6587\u4ef6\u3002\u6bd4\u5982\u6709\u5982\u4e0b java \u6e90\u6587\u4ef6\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'//Hello.java\npublic class Hello{\n    public static void main(String[] args)throws Exception{\n        while(true){\n            test1();\n            Thread.sleep(1000L);\n        }\n    }\n    public static void test1(){\n        test2();\n    }\n    public static void test2(){\n        System.out.println("invoke test2");\n    }\n}\n')),(0,o.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7 javac \u547d\u4ee4\u6765\u7f16\u8bd1.java \u6e90\u6587\u4ef6\u6587\u4ef6\u5f97\u5230.class \u5b57\u8282\u7801\u6587\u4ef6\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"javac Hello.java\n")),(0,o.kt)("p",null,"\u800c\u5f53\u6211\u4eec\u5728\u547d\u4ee4\u884c\u4f7f\u7528 javac \u547d\u4ee4\u6765\u7f16\u8bd1 Java \u6587\u4ef6\u65f6\uff0c\u5b9e\u9645\u4e0a\u5185\u90e8\u662f\u8c03\u7528\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"%JAVA_HOME%/lib/tools.jar"),"\uff08\u5728 Java9 \u4e4b\u540e\uff0c\u76f4\u63a5\u88ab\u5305\u542b\u5728 Java \u7684 src\uff0c\u800c\u4e0d\u662f\u4ee5\u6269\u5c55 jar \u5305\u7684\u5f62\u5f0f\u5f15\u7528\uff09\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.Main#main"),"\u65b9\u6cd5\u6765\u542f\u52a8\u7f16\u8bd1\u8fc7\u7a0b\uff0c\u6240\u4ee5\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u65b9\u6cd5\u6765\u7f16\u8bd1\u6e90\u6587\u4ef6\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"java -cp tools.jar com.sun.tools.javac.Main Hello.java\n")),(0,o.kt)("p",null,"\u4e24\u8005\u7b49\u6548\uff0c\u90fd\u53ef\u4ee5\u7f16\u8bd1\u6e90\u6587\u4ef6"),(0,o.kt)("p",null,"\uff082\uff09\u7f16\u8bd1\u7684\u5165\u53e3\u4e3a JavaCompiler"),(0,o.kt)("p",null,"\u8fd9\u91cc\u4ee5 Javac \u547d\u4ee4\u4e3a\u4f8b\uff0c\u7a0b\u5e8f\u9996\u5148\u4f1a\u8fdb\u5165\u5230 ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.Main#main")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'// com.sun.tools.javac.Main\n@Exported\npublic class Main {\n    public Main() {\n    }\n\n    // \u8fd9\u5c31\u662f\u4e00\u4e2a\u6b63\u5e38\u7684main\u65b9\u6cd5\n    public static void main(String[] var0) throws Exception {\n        System.exit(compile(var0));\n    }\n\n    public static int compile(String[] var0) {\n        com.sun.tools.javac.main.Main var1 = new com.sun.tools.javac.main.Main("javac");\n        return var1.compile(var0).exitCode;\n    }\n\n    public static int compile(String[] var0, PrintWriter var1) {\n        com.sun.tools.javac.main.Main var2 = new com.sun.tools.javac.main.Main("javac", var1);\n        return var2.compile(var0).exitCode;\n    }\n}\n')),(0,o.kt)("p",null,"\u7136\u540e\u4f1a\u7ecf\u8fc7 ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.main.Main#compile"),"\u65b9\u6cd5\uff0c\u5728\u6b64\u65b9\u6cd5\u4e2d\u4f1a\u8c03\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.main.JavaCompiler#compile"),"\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"    /**\n     * Main method: compile a list of files, return all compiled classes\n     *\n     * @param sourceFileObjects file objects to be compiled\n     * @param classnames class names to process for annotations\n     * @param processors user provided annotation processors to bypass\n     * discovery, {@code null} means that no processors were provided\n     * @param addModules additional root modules to be used during\n     * module resolution.\n     */\n    public void compile(Collection<JavaFileObject> sourceFileObjects,\n                        Collection<String> classnames,\n                        Iterable<? extends Processor> processors,\n                        Collection<String> addModules)\n    {\n        ...\n        // \u51c6\u5907\u8fc7\u7a0b\uff1a\u521d\u59cb\u5316\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\uff0c\u6700\u7ec8\u662f\u901a\u8fc7ServiceLoader\u83b7\u53d6\u6240\u6709Processor.class\u7684\u5b9e\u73b0\u7c7b\n        initProcessAnnotations(processors, sourceFileObjects, classnames);\n\n        // These method calls must be chained to avoid memory leaks\n        // 2. \u6267\u884c\u6ce8\u89e3\u5904\u7406\n        processAnnotations(\n            // 1.2 \u586b\u5145\u7b26\u53f7\u8868\n            enterTrees(\n                    stopIfError(CompileState.ENTER,\n                            initModules(stopIfError(CompileState.ENTER,\n                                // 1.1 \u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\uff0c\u4ece\u800c\u6784\u5efa\u51fa\u4e00\u68f5AST\u62bd\u8c61\u8bed\u6cd5\u6811\uff0csourceFileObjects\u5373\u4e3aJava\u6e90\u6587\u4ef6\u5728\u5185\u5b58\u4e2d\u7684\u8868\u793a\n                                parseFiles(sourceFileObjects))))\n            ),\n            classnames\n        );\n        ...\n\n        if (!CompileState.ATTR.isAfter(shouldStopPolicyIfNoError)) {\n            switch (compilePolicy) {\n            ...\n            case BY_TODO:\n                while (!todo.isEmpty())\n                    // 3.\u8bed\u4e49\u5206\u6790\u53ca\u5b57\u8282\u7801\u751f\u6210\n                    generate(desugar(flow(attribute(todo.remove()))));\n                break;\n            ...\n        }\n")),(0,o.kt)("p",null,"\u82e5\u662f\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u5982 Maven\u3001Idea\u3001Eclipse \u7b49\u7684\u7f16\u8bd1\uff0c\u53ef\u80fd\u4f1a\u901a\u8fc7\u8c03\u7528",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.api.JavacTaskImpl"),"\u800c\u6700\u7ec8\u8fdb\u5165\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.main.JavaCompiler#compile"),"\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0cJavaCompiler \u5c31\u662f\u7f16\u8bd1\u7684\u5165\u53e3\u3002"),(0,o.kt)("h3",{id:"3\u7f16\u8bd1\u671f-debug"},"3.\u7f16\u8bd1\u671f Debug"),(0,o.kt)("p",null,"\u8fd0\u884c\u671f\u7684 Debug \u6211\u4eec\u90fd\u4f1a\uff0c\u90a3\u4e48\u5982\u4f55\u8fdb\u884c\u7f16\u8bd1\u671f\u7684 Debug\uff1f\u53ef\u4ee5\u501f\u52a9 Maven \u5b9e\u73b0\uff0c\u5982\u4e0b\u6240\u793a\uff1a"),(0,o.kt)("p",null,"\uff081\uff09\u5728\u6307\u5b9a\u9879\u76ee\u4e0b\uff0c\u6267\u884c ",(0,o.kt)("inlineCode",{parentName:"p"},"mvnDebug clean compile"),"\uff0c\u8fd9\u65f6maven\u4f1a\u963b\u585e\u4f4f\uff0c\u76f4\u52308000\u7aef\u53e3\u6709\u8fde\u63a5\u8fdb\u6765"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ mvnDebug clean compile\nPreparing to execute Maven in debug mode\nListening for transport dt_socket at address: 8000\n")),(0,o.kt)("p",null,"\uff082\uff09\u63a5\u7740\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.main.JavaCompiler#compile"),"\u65b9\u6cd5\u4e2d\u6253\u4e00\u4e2a\u65ad\u70b9"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210611220155383",src:t(9656).Z,width:"613",height:"418"})),(0,o.kt)("p",null,"\uff083\uff09\u6700\u540e\u5728 Idea \u4e2d, \u521b\u5efa\u4e00\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"Remote JVM Debug"),", \u5e76\u6307\u5b9a\u7aef\u53e3\u4e3a\u524d\u9762\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"8000")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210611215844810",src:t(82326).Z,width:"802",height:"679"})),(0,o.kt)("p",null,"\u7136\u540e\u4ee5 Debug \u65b9\u5f0f\u8fd0\u884c\uff0c\u7a0b\u5e8f\u4fbf\u4f1a\u505c\u5728\u65ad\u70b9\u5904"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210611215952628",src:t(41704).Z,width:"781",height:"419"})),(0,o.kt)("h2",{id:"\u56dbjavac-\u7f16\u8bd1\u5668\u6e90\u7801\u5206\u6790"},"\u56db\u3001JavaC \u7f16\u8bd1\u5668\u6e90\u7801\u5206\u6790"),(0,o.kt)("h3",{id:"1\u89e3\u6790\u4e0e\u586b\u5145\u7b26\u53f7\u8868"},"1.\u89e3\u6790\u4e0e\u586b\u5145\u7b26\u53f7\u8868"),(0,o.kt)("h4",{id:"11-\u8bcd\u6cd5\u5206\u6790"},"1.1 \u8bcd\u6cd5\u5206\u6790"),(0,o.kt)("p",null,"\u8bcd\u6cd5\u5206\u6790\u662f\u5c06\u6e90\u4ee3\u7801\u7684\u5b57\u7b26\u6d41\u8f6c\u53d8\u4e3a Token \u96c6\u5408\uff0c\u5355\u4e2a\u5b57\u7b26\u662f\u7a0b\u5e8f\u7f16\u5199\u8fc7\u7a0b\u7684\u6700\u5c0f\u5143\u7d20\uff0c\u800c Token \u5219\u662f\u7f16\u8bd1\u8fc7\u7a0b\u7684\u6700\u5c0f\u5143\u7d20\uff0c\u5173\u952e\u5b57\u3001\u53d8\u91cf\u540d\u3001\u5b57\u9762\u91cf\u3001\u8fd0\u7b97\u7b26\u90fd\u53ef\u4ee5\u6210\u4e3a Token\u3002"),(0,o.kt)("p",null,"\u8bcd\u6cd5\u3001\u8bed\u6cd5\u5206\u6790\u7684\u5165\u53e3\u4e3a parseFiles\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'   public List<JCCompilationUnit> parseFiles(Iterable<JavaFileObject> fileObjects, boolean force) {\n       if (!force && shouldStop(CompileState.PARSE))\n           return List.nil();\n\n        // \u89e3\u6790\u6240\u6709java\u6e90\u6587\u4ef6\uff0c\u7136\u540e\u8f6c\u6362\u6210AST\u5148\u540e\u5411\u8bed\u6cd5\u6811, JCCompilationUnit\u7ee7\u627f\u81eaJCTree\uff0c\u5373\u4e3a\u62bd\u8c61\u8bed\u6cd5\u6811\n        //parse all files\n        ListBuffer<JCCompilationUnit> trees = new ListBuffer<>();\n        Set<JavaFileObject> filesSoFar = new HashSet<>();\n        for (JavaFileObject fileObject : fileObjects) {\n            if (!filesSoFar.contains(fileObject)) {\n                filesSoFar.add(fileObject);\n                // \u89e3\u6790\u6e90\u6587\u4ef6\n                trees.append(parse(fileObject));\n            }\n        }\n        return trees.toList();\n    }\n\n    public JCTree.JCCompilationUnit parse(JavaFileObject filename) {\n        JavaFileObject prev = log.useSource(filename);\n        try {\n            // \u6b64\u5904 readSource \u4f1a\u83b7\u53d6\u6e90\u6587\u4ef6\u7684\u6e90\u7801\u5185\u5bb9\n            JCTree.JCCompilationUnit t = parse(filename, readSource(filename));\n            if (t.endPositions != null)\n                log.setEndPosTable(filename, t.endPositions);\n            return t;\n        } finally {\n            log.useSource(prev);\n        }\n    }\n\n    protected JCCompilationUnit parse(JavaFileObject filename, CharSequence content) {\n        long msec = now();\n        JCCompilationUnit tree = make.TopLevel(List.nil());\n        if (content != null) {\n            if (verbose) {\n                log.printVerbose("parsing.started", filename);\n            }\n            if (!taskListener.isEmpty()) {\n                TaskEvent e = new TaskEvent(TaskEvent.Kind.PARSE, filename);\n                taskListener.started(e);\n                keepComments = true;\n                genEndPos = true;\n            }\n            // \u5728\u6784\u9020 JavacParser \u7684\u65f6\u5019\u4f1a\u901a\u8fc7 com.sun.tools.javac.parser.Scanner \u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\n            Parser parser = parserFactory.newParser(content, keepComments(), genEndPos,\n                                lineDebugInfo, filename.isNameCompatible("module-info", Kind.SOURCE));\n            // \u8bed\u6cd5\u5206\u6790\uff1a\u901a\u8fc7JavacParser\u8fdb\u884c\u8bed\u6cd5\u5206\u6790\uff0c\u5f97\u5230AST\u62bd\u8c61\u8bed\u6cd5\u6811\n            tree = parser.parseCompilationUnit();\n            if (verbose) {\n                log.printVerbose("parsing.done", Long.toString(elapsed(msec)));\n            }\n        }\n\n        tree.sourcefile = filename;\n\n        if (content != null && !taskListener.isEmpty()) {\n            TaskEvent e = new TaskEvent(TaskEvent.Kind.PARSE, tree);\n            taskListener.finished(e);\n        }\n\n        return tree;\n    }\n\n')),(0,o.kt)("p",null,"\u5728\u6784\u9020 Parser \u7684\u65f6\u5019\u4f1a\u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"\npublic class ParserFactory {\n\n    public JavacParser newParser(CharSequence input, boolean keepDocComments, boolean keepEndPos, boolean keepLineMap, boolean parseModuleInfo) {\n        // \u6784\u9020\u4e00\u4e2a\u8bcd\u6cd5\u5206\u6790\u5668Lexer\uff0c\u5176\u5b9e\u73b0\u7c7b\u4e3a`com.sun.tools.javac.parser.Scanner`\n        Lexer lexer = scannerFactory.newScanner(input, keepDocComments);\n        // \u5728 JavacParser \u7684\u6784\u9020\u65b9\u6cd5\u4e2d\u4f1a\u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\n        return new JavacParser(this, lexer, keepDocComments, keepLineMap, keepEndPos, parseModuleInfo);\n    }\n}\n\n")),(0,o.kt)("p",null,"\u5148\u6784\u9020\u4e00\u4e2a\u8bcd\u6cd5\u5206\u6790\u5668 Lexer\uff0c\u5176\u5b9e\u73b0\u7c7b\u4e3a",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.parser.Scanner"),"\uff0c\u5176\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"\npublic class Scanner implements Lexer {\n\n    private Tokens tokens;\n\n    /** The token, set by nextToken().\n     */\n    private Token token;\n\n    /** The previous token, set by nextToken().\n     */\n    private Token prevToken;\n\n    /** Buffer of saved tokens (used during lookahead)\n     */\n    private List<Token> savedTokens = new ArrayList<>();\n\n    private JavaTokenizer tokenizer;\n\n\n    public void nextToken() {\n        prevToken = token;\n        if (!savedTokens.isEmpty()) {\n            token = savedTokens.remove(0);\n        } else {\n            token = tokenizer.readToken();\n        }\n    }\n}\n\n// \u901a\u8fc7\npublic static class Token {\n\n    /** tags constants **/\n    enum Tag {\n        DEFAULT,\n        NAMED,\n        STRING,\n        NUMERIC;\n    }\n\n    /** The token kind */\n    public final TokenKind kind;\n\n    /** The start position of this token */\n    public final int pos;\n\n    /** The end position of this token */\n    public final int endPos;\n\n    /** Comment reader associated with this token */\n    public final List<Comment> comments;\n}\n\npublic class Tokens {\n\n    private final Names names;\n\n    /**\n     * Keyword array. Maps name indices to Token.\n     */\n    private final TokenKind[] key;\n\n    /**  The number of the last entered keyword.\n     */\n    private int maxKey = 0;\n\n    /** The names of all tokens.\n     */\n    private Name[] tokenName = new Name[TokenKind.values().length];\n}\n\n\n")),(0,o.kt)("p",null,"\u5728 JavacParser \u7684\u6784\u9020\u65b9\u6cd5\u4e2d\uff0c\u4f1a\u4f7f\u7528 JavaTokenizer \u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\uff0c\u4ece\u800c\u5f97\u5230 Token \u96c6\u5408"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"public class JavacParser implements Parser {\n\n    protected JavacParser(ParserFactory fac,\n                     Lexer S,\n                     boolean keepDocComments,\n                     boolean keepLineMap,\n                     boolean keepEndPositions,\n                     boolean parseModuleInfo) {\n        this.S = S;\n        nextToken(); // prime the pump\n        ...\n    }\n\n    public void nextToken() {\n        S.nextToken();\n        token = S.token();\n    }\n}\n\n\npublic class Scanner implements Lexer {\n\n    private Tokens tokens;\n\n    /** The token, set by nextToken().\n     */\n    private Token token;\n\n    /** The previous token, set by nextToken().\n     */\n    private Token prevToken;\n\n    /** Buffer of saved tokens (used during lookahead)\n     */\n    private List<Token> savedTokens = new ArrayList<>();\n\n    private JavaTokenizer tokenizer;\n\n\n    public void nextToken() {\n        prevToken = token;\n        if (!savedTokens.isEmpty()) {\n            token = savedTokens.remove(0);\n        } else {\n            // \u8bcd\u6cd5\u5206\u6790\uff0c\u83b7\u53d6token\u96c6\u5408\n            token = tokenizer.readToken();\n        }\n    }\n}\n\n")),(0,o.kt)("p",null,"JavaTokenizer \u4e2d\u5b58\u50a8\u4e86\u6e90\u7801\u7684\u5b57\u7b26\u6d41\uff0c\u4f1a\u6328\u4e2a\u8bfb\u53d6\u5b57\u7b26\uff0c\u5224\u65ad\u5176\u5c5e\u4e8e\u54ea\u79cd Token\uff0c\u5728\u679a\u4e3e\u7c7b TokenKind \u4e2d\u53ef\u4ee5\u770b\u5230\u6240\u6709 Token \u79cd\u7c7b"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210604145859441",src:t(36595).Z,width:"467",height:"628"})),(0,o.kt)("p",null,"\u8bcd\u6cd5\u5206\u6790\u7684\u5177\u4f53\u7ec6\u8282\u53ef\u89c1 ",(0,o.kt)("inlineCode",{parentName:"p"},"JavaTokenizer#readToken()")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210604193840324",src:t(89329).Z,width:"387",height:"679"})),(0,o.kt)("h4",{id:"12-javac-\u62bd\u8c61\u8bed\u6cd5\u6811"},"1.2 Javac \u62bd\u8c61\u8bed\u6cd5\u6811"),(0,o.kt)("p",null,"\uff081\uff09 \u62bd\u8c61\u8bed\u6cd5\u6811\u7684\u7ed3\u6784"),(0,o.kt)("img",{src:"https://www.plantuml.com/plantuml/png/XPBFIiD04CRl-nJp048V818ggGUBIg7r0RR9D2pkFtPNQ2YUlGW5GV45z2GYUFBaozXAtwARJMoRLFIItTdzpJVpJRPh7JNkId12c7He9ZH563hgKA1q8uC8E7KeCmiXc5qJGiVM6PewI3cr5lf9k652yv1KaGUGS2MHZhdVzXZDfRAEfGDbcMDAmeoGtwGsfJTbz-MRxLL2F_c94ffnMfQua6nFfGaFQ7f9S-nXojkW9m5EcNM7_UH8IkM2P0nqixUH9_h9yLGRjBQqf5bMdjMgmqAC5GVjenoZtR8dGYlpJsjdAcCJXiQsi9RRScsrlvrWy00DCQ4o6q6d0r-Vhwkdj--Nvu2SKu4W_ISAOUrxL6WSKEEF_SE8mHMw36nKg-uuhwepcJVojq2y_Nr_GHgDO6uFANt7aE6aQdtvyB5ylr_StIxcZwkRUI338Eg9sqA4SHFIzKtvfxq6",alt:null}),(0,o.kt)("p",null,"Java \u6e90\u7801\u5728\u7f16\u8bd1\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u89e3\u6790\u6210\u4e00\u4e2a\u8bed\u6cd5\u6811\uff0c\u8fd9\u68f5\u8bed\u6cd5\u6811\u5c31\u662f JCCompilationUnit\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u7f16\u8bd1\u5355\u5143\u3002\n\u5176\u4e2d\u8fd9\u68f5\u8bed\u6cd5\u6811\u6839\u8282\u70b9\u7684\u5b50\u8282\u70b9\u4e3a\u5305\u58f0\u660e\u7ed3\u70b9\u3001Import \u58f0\u660e\u7ed3\u70b9\u3001\u7c7b\u58f0\u660e\u7ed3\u70b9\u90fd\u662f\u6811\u7684\u4e00\u7ea7\u7ed3\u70b9\uff0c\u4f8b\u5982\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"package com.ray.study.smaple.beanmap.mapstruct.dto; // \u5bf9\u5e94\u5305\u58f0\u660e\u7ed3\u70b9 JCPackageDecl\n\nimport lombok.Data;  // \u5bf9\u5e94Import\u58f0\u660e\u7ed3\u70b9 JCImport\n\nimport java.util.List; // \u5bf9\u5e94Import\u58f0\u660e\u7ed3\u70b9 JCImport\n\n/**\n * description\n *\n * @author r.shi 2021/5/26 15:37\n */\n\n// \u4e0b\u9762\u7684\u6240\u6709\u4ee3\u7801\u5bf9\u5e94JCClassDecl\u7ed3\u70b9\n@Data  // \u6ce8\u89e3 \u548c public \u5bf9\u5e94 \u4fee\u9970\u7b26\u7ed3\u70b9 JCModifiers\npublic class UserDTO {\n    private Long id;             // \u5bf9\u5e94\u53d8\u91cf\u58f0\u660e\u7ed3\u70b9 JCVariableDecl\n    private String userName;     // \u5bf9\u5e94\u53d8\u91cf\u58f0\u660e\u7ed3\u70b9 JCVariableDecl\n    private Boolean userStatus;  // \u5bf9\u5e94\u53d8\u91cf\u58f0\u660e\u7ed3\u70b9 JCVariableDecl\n    private Long createTime;     // \u5bf9\u5e94\u53d8\u91cf\u58f0\u660e\u7ed3\u70b9 JCVariableDecl\n\n    private List<RoleDTO> roles; // \u5bf9\u5e94\u53d8\u91cf\u58f0\u660e\u7ed3\u70b9 JCVariableDecl\n}\n\n")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210604193311967",src:t(48686).Z,width:"981",height:"121"})),(0,o.kt)("p",null,"\uff082\uff09\u62bd\u8c61\u8bed\u6cd5\u6811\u662f\u5982\u4f55\u751f\u6210\u7684\uff1f"),(0,o.kt)("p",null,"\u53ef\u4ee5\u901a\u8fc7 ",(0,o.kt)("inlineCode",{parentName:"p"},"JCTree")," \u7684\u5de5\u5382\u7c7b ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.tree.TreeMaker")," \u751f\u6210"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"\npublic class TreeMaker implements JCTree.Factory {\n\n    public JCClassDecl ClassDef(JCModifiers mods,\n                                Name name,\n                                List<JCTypeParameter> typarams,\n                                JCExpression extending,\n                                List<JCExpression> implementing,\n                                List<JCExpression> permitting,\n                                List<JCTree> defs)\n    {\n        JCClassDecl tree = new JCClassDecl(mods,\n                                     name,\n                                     typarams,\n                                     extending,\n                                     implementing,\n                                     permitting,\n                                     defs,\n                                     null);\n        tree.pos = pos;\n        return tree;\n    }\n\n    public JCMethodDecl MethodDef(JCModifiers mods,\n                               Name name,\n                               JCExpression restype,\n                               List<JCTypeParameter> typarams,\n                               List<JCVariableDecl> params,\n                               List<JCExpression> thrown,\n                               JCBlock body,\n                               JCExpression defaultValue) {\n        return MethodDef(\n                mods, name, restype, typarams, null, params,\n                thrown, body, defaultValue);\n    }\n}\n")),(0,o.kt)("h4",{id:"13-\u8bed\u6cd5\u5206\u6790"},"1.3 \u8bed\u6cd5\u5206\u6790"),(0,o.kt)("p",null,"\u7136\u540e\u6839\u636e Token \u5e8f\u5217\u6784\u9020\u62bd\u8c61\u8bed\u6cd5\u6811"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'\n// JavacParser\npublic JCTree.JCCompilationUnit parseCompilationUnit() {\n\n    Token firstToken = token;\n    JCModifiers mods = null;\n    boolean consumedToplevelDoc = false;\n    boolean seenImport = false;\n    boolean seenPackage = false;\n    ListBuffer<JCTree> defs = new ListBuffer<>();\n    if (token.kind == MONKEYS_AT)\n        mods = modifiersOpt();\n\n    // 1.\u5305\u58f0\u660e\u8bed\u6cd5\u5206\u6790\n    // PackageDeclaration = PACKAGE Ident { DOT [Annotations] Ident } ;\n    if (token.kind == PACKAGE) {\n        // \u82e5\u9047\u5230\u7684 token \u662f PACKAGE\u7c7b\u578b\uff0c\n        int packagePos = token.pos;\n        List<JCAnnotation> annotations = List.nil();\n        seenPackage = true;\n        if (mods != null) {\n            checkNoMods(mods.flags & ~Flags.DEPRECATED);\n            annotations = mods.annotations;\n            mods = null;\n        }\n        nextToken();\n        // \u5f97\u5230\u5177\u4f53\u5305\u540d\n        JCExpression pid = qualident(false);\n        // \u5224\u65ad\u662f\u5426\u4ee5 `;` \u7ed3\u5c3e\uff0caccept\u901a\u8fc7\u8bf4\u660e\u662f\u6b63\u786e\u7684\u5305\u58f0\u660e\u8bed\u53e5\n        accept(SEMI);\n        // \u6784\u9020\u5305\u58f0\u660e\n        JCPackageDecl pd = toP(F.at(packagePos).PackageDecl(annotations, pid));\n        attach(pd, firstToken.comment(CommentStyle.JAVADOC));\n        consumedToplevelDoc = true;\n        defs.append(pd);\n    }\n\n    boolean checkForImports = true;\n    boolean firstTypeDecl = true;\n    while (token.kind != EOF) {\n        if (token.pos <= endPosTable.errorEndPos) {\n            // error recovery\n            skip(checkForImports, false, false, false);\n            if (token.kind == EOF)\n                break;\n        }\n        if (checkForImports && mods == null && token.kind == IMPORT) {\n            // 2.import \u58f0\u660e\u8bed\u6cd5\u5206\u6790\n            // ImportDeclaration = IMPORT [ STATIC ] Ident { "." Ident } [ "." "*" ] ";"\n            seenImport = true;\n            defs.append(importDeclaration());\n        } else {\n            Comment docComment = token.comment(CommentStyle.JAVADOC);\n            if (firstTypeDecl && !seenImport && !seenPackage) {\n                docComment = firstToken.comment(CommentStyle.JAVADOC);\n                consumedToplevelDoc = true;\n            }\n            if (mods != null || token.kind != SEMI)\n                // 3.\u4fee\u9970\u7b26\n                mods = modifiersOpt(mods);\n            if (firstTypeDecl && token.kind == IDENTIFIER) {\n                ModuleKind kind = ModuleKind.STRONG;\n                if (token.name() == names.open) {\n                    kind = ModuleKind.OPEN;\n                    nextToken();\n                }\n                if (token.kind == IDENTIFIER && token.name() == names.module) {\n                    if (mods != null) {\n                        checkNoMods(mods.flags & ~Flags.DEPRECATED);\n                    }\n                    defs.append(moduleDecl(mods, kind, docComment));\n                    consumedToplevelDoc = true;\n                    break;\n                } else if (kind != ModuleKind.STRONG) {\n                    reportSyntaxError(token.pos, Errors.ExpectedModule);\n                }\n            }\n            // 4.\u7c7b\u578b\u58f0\u660e\u8bed\u6cd5\u5206\u6790\n            JCTree def = typeDeclaration(mods, docComment);\n            if (def instanceof JCExpressionStatement)\n                def = ((JCExpressionStatement)def).expr;\n            defs.append(def);\n            if (def instanceof JCClassDecl)\n                checkForImports = false;\n            mods = null;\n            firstTypeDecl = false;\n        }\n    }\n\n    // \u6784\u5efatoplevel\u6839\u7ed3\u70b9\uff0c\u5e76\u5c06\u5305\u58f0\u660e\u7ed3\u70b9\u3001Import\u58f0\u660e\u7ed3\u70b9\u3001\u7c7b\u578b\u58f0\u660e\u7ed3\u70b9\u4f5c\u4e3a\u5176\u5b50\u7ed3\u70b9\n    JCTree.JCCompilationUnit toplevel = F.at(firstToken.pos).TopLevel(defs.toList());\n    if (!consumedToplevelDoc)\n        attach(toplevel, firstToken.comment(CommentStyle.JAVADOC));\n    if (defs.isEmpty())\n        storeEnd(toplevel, S.prevToken().endPos);\n    if (keepDocComments)\n        toplevel.docComments = docComments;\n    if (keepLineMap)\n        toplevel.lineMap = S.getLineMap();\n    this.endPosTable.setParser(null); // remove reference to parser\n    toplevel.endPositions = this.endPosTable;\n    return toplevel;\n}\n\n/** ClassOrInterfaceOrEnumDeclaration = ModifiersOpt\n    *           (ClassDeclaration | InterfaceDeclaration | EnumDeclaration)\n    *  @param mods     Any modifiers starting the class or interface declaration\n    *  @param dc       The documentation comment for the class, or null.\n    */\nprotected JCStatement classOrRecordOrInterfaceOrEnumDeclaration(JCModifiers mods, Comment dc) {\n    if (token.kind == CLASS) {\n        // \u7c7b\u58f0\u660e\u8bed\u6cd5\u5206\u6790\n        return classDeclaration(mods, dc);\n    } if (isRecordStart()) {\n        return recordDeclaration(mods, dc);\n    } else if (token.kind == INTERFACE) {\n        // \u63a5\u53e3\u58f0\u660e\u8bed\u6cd5\u5206\u6790\n        return interfaceDeclaration(mods, dc);\n    } else if (token.kind == ENUM) {\n        // \u679a\u4e3e\u58f0\u660e\u8bed\u6cd5\u5206\u6790\n        return enumDeclaration(mods, dc);\n    } else {\n        int pos = token.pos;\n        List<JCTree> errs;\n        if (token.kind == IDENTIFIER && token.name() == names.record) {\n            checkSourceLevel(Feature.RECORDS);\n            JCErroneous erroneousTree = syntaxError(token.pos, List.of(mods), Errors.RecordHeaderExpected);\n            return toP(F.Exec(erroneousTree));\n        } else {\n            if (LAX_IDENTIFIER.accepts(token.kind)) {\n                errs = List.of(mods, toP(F.at(pos).Ident(ident())));\n                setErrorEndPos(token.pos);\n            } else {\n                errs = List.of(mods);\n            }\n            final JCErroneous erroneousTree;\n            if (parseModuleInfo) {\n                erroneousTree = syntaxError(pos, errs, Errors.ExpectedModuleOrOpen);\n            } else {\n                if (allowRecords) {\n                    erroneousTree = syntaxError(pos, errs, Errors.Expected4(CLASS, INTERFACE, ENUM, "record"));\n                } else {\n                    erroneousTree = syntaxError(pos, errs, Errors.Expected3(CLASS, INTERFACE, ENUM));\n                }\n            }\n            return toP(F.Exec(erroneousTree));\n        }\n    }\n}\n\n/** ClassDeclaration = CLASS Ident TypeParametersOpt [EXTENDS Type]\n    *                     [IMPLEMENTS TypeList] ClassBody\n    *  @param mods    The modifiers starting the class declaration\n    *  @param dc       The documentation comment for the class, or null.\n    */\nprotected JCClassDecl classDeclaration(JCModifiers mods, Comment dc) {\n    int pos = token.pos;\n    accept(CLASS);\n    Name name = typeName();\n\n    List<JCTypeParameter> typarams = typeParametersOpt();\n\n    JCExpression extending = null;\n    if (token.kind == EXTENDS) {\n        nextToken();\n        extending = parseType();\n    }\n    List<JCExpression> implementing = List.nil();\n    if (token.kind == IMPLEMENTS) {\n        nextToken();\n        implementing = typeList();\n    }\n    List<JCExpression> permitting = permitsClause(mods, "class");\n    List<JCTree> defs = classInterfaceOrRecordBody(name, false, false);\n    JCClassDecl result = toP(F.at(pos).ClassDef(\n        mods, name, typarams, extending, implementing, permitting, defs));\n    attach(result, dc);\n    return result;\n}\n\n')),(0,o.kt)("h4",{id:"14-\u586b\u5145\u7b26\u53f7\u8868"},"1.4 \u586b\u5145\u7b26\u53f7\u8868"),(0,o.kt)("h5",{id:"141-\u7b26\u53f7\u8868\u7684\u6570\u636e\u7ed3\u6784"},"1.4.1 \u7b26\u53f7\u8868\u7684\u6570\u636e\u7ed3\u6784"),(0,o.kt)("p",null,"Javac \u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u9700\u8981\u9891\u7e41\u67e5\u627e\u88ab\u5f15\u7528\u7684\u7b26\u53f7\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u5b9a\u7684\u7ed3\u6784\u6765\u7ec4\u7ec7\u8fd9\u4e9b\u7b26\u53f7\uff0c\u8fd9\u5c31\u662f\u7b26\u53f7\u8868\u3002"),(0,o.kt)("p",null,"\u7b26\u53f7\u4e00\u822c\u90fd\u662f\u4e0e\u4f5c\u7528\u57df\u5173\u8054\u7684\uff0cJava \u7684\u4f5c\u7528\u57df\u662f\u5d4c\u5957\u7684\uff0c\u8fd9\u6837 Javac \u5728\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 Scope \u7c7b\u6765\u5b9e\u73b0\u4f5c\u7528\u57df\u7684\u5d4c\u5957\uff0c\u7136\u540e\u5c06\u6bcf\u4e2a\u4f5c\u7528\u57df\u4e2d\u5b9a\u4e49\u7684\u7b26\u53f7\u5206\u522b\u4fdd\u5b58\u5230\u5bf9\u5e94\u4f5c\u7528\u57df\u7684\u76f8\u5173\u53d8\u91cf\u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u904d\u5386\u4f5c\u7528\u57df\u7684\u65b9\u5f0f\u67e5\u627e\u552f\u4e00\u7684\u7b26\u53f7\u5f15\u7528\u4e86\u3002"),(0,o.kt)("p",null,"\u4f5c\u7528\u57df\uff08Scope\uff09\u5927\u90e8\u5206\u90fd\u4ee5\u82b1\u62ec\u53f7\u5206\u9694\uff0c\u540c\u4e00\u4e2a\u7b26\u53f7\u5728\u4e0d\u540c\u7684\u4f5c\u7528\u57df\u4e2d\u53ef\u80fd\u6307\u5411\u4e0d\u540c\u7684\u5b9e\u4f53\u3002"),(0,o.kt)("p",null,"Scope \u7c7b\u56fe\u5982\u4e0b\uff1a"),(0,o.kt)("img",{src:"https://www.plantuml.com/plantuml/png/SoWkIImgAStDuKfCAYufIamkKKZEIImkLWXEpYz8LQZcKW22uChSfFmSXVpolDGYQwvQBYw8al2Yp9BKnAISL8ZQr8gIrBmKX4w4Gh28Psv13bmDcbQ8DPbv9Gh56Ob5gIdM46lXslA0-gmLzFKLdaxeUxvxELZMDQ-ag38wLg44P0nOylcQPK_xjxzOk09kMaPYSOPlOd6sDKA7GcfEQcunMFsJ_NEVhftnj7VgoydxWBgUx5ZxV5RBosNJdknO1LOADoOFh4V1Li40hEzPm-vdKpSWl0Sn5oMeYYjpaUq4-YeblnpcBuWOo4_1cKavcNdfoC85HQbbACA8K2W6iI0kw6nukd7UaxrpdazPyNJ-V91J783X2ef60000",alt:null}),(0,o.kt)("p",null,"\u4e00\u4e2a\u4f5c\u7528\u57df\u5185\u5b9a\u4e49\u7684\u591a\u4e2a\u7b26\u53f7\u5b58\u50a8\u5728 table \u6570\u7ec4\u4e2d\uff0c\u7531\u4e8e table \u6570\u7ec4\u4e13\u95e8\u7528\u6765\u5b58\u50a8\u7b26\u53f7\uff0c\u56e0\u800c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u53eb\u7b26\u53f7\u8868\u3002\u540c\u4e00\u4e2a\u4f5c\u7528\u57df\u5185\u5b9a\u4e49\u7684\u6240\u6709\u7b26\u53f7\u4f1a\u5f62\u6210\u5355\u94fe\u8868\uff0celems \u4fdd\u5b58\u4e86\u8fd9\u4e2a\u5355\u94fe\u8868\u7684\u9996\u4e2a Entry \u5bf9\u8c61\uff0cnelems \u4fdd\u5b58\u4e86\u5355\u94fe\u8868\u4e2d Entry \u5bf9\u8c61\u7684\u603b\u6570\u3002"),(0,o.kt)("p",null,"\u800c\u7b26\u53f7\u7684\u6570\u636e\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,o.kt)("img",{src:"https://www.plantuml.com/plantuml/png/SoWkIImgAStDuKhEIImkLWYkp4tApwdcKW02xyoy58Li864DvlebvgOgv04923UaiY1LeGH8GBWGZGhvvNcfHH2HdFoyT8MqdCJqulYqpDIS56i5VNs59_ldFbqxu_cQPK_xjp_Pl-xbqWr0DbYvStvkGKvgIMgHGZACPSt5LSkLc5HSKfIONA80SI38MgXTgHKbgNafS3VNSa7z492Od9sOZguAeH6XqXb4ubIdW50ObbY4rL8a9Rwf9HdvAOHK-HUa5YMMvAERXg8PfDe1A0oC5G00",alt:null}),(0,o.kt)("p",null,"\u540c\u65f6\u7b26\u53f7\u8fd8\u4f1a\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"Symtab"),"\u4e2d\u7f13\u5b58\u8d77\u6765\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"public class Symtab {\n    ...\n    private final Map<Name, Map<ModuleSymbol,ClassSymbol>> classes = new HashMap<>();\n    private final Map<Name, Map<ModuleSymbol,PackageSymbol>> packages = new HashMap<>();\n    ...\n\n    /** Create a new toplevel or member class symbol with given name\n     *  and owner and enter in `classes' unless already there.\n     */\n    public ClassSymbol enterClass(ModuleSymbol msym, Name name, TypeSymbol owner) {\n        Assert.checkNonNull(msym);\n        Name flatname = TypeSymbol.formFlatName(name, owner);\n        ClassSymbol c = getClass(msym, flatname);\n        if (c == null) {\n            c = defineClass(name, owner);\n            doEnterClass(msym, c);\n        } else if ((c.name != name || c.owner != owner) && owner.kind == TYP && c.owner.kind == PCK) {\n            // reassign fields of classes that might have been loaded with\n            // their flat names.\n            c.owner.members().remove(c);\n            c.name = name;\n            c.owner = owner;\n            c.fullname = ClassSymbol.formFullName(name, owner);\n        }\n        return c;\n    }\n}\n\n\n")),(0,o.kt)("h5",{id:"142-\u7b26\u53f7\u8868\u7684\u586b\u5145\u8fc7\u7a0b"},"1.4.2 \u7b26\u53f7\u8868\u7684\u586b\u5145\u8fc7\u7a0b"),(0,o.kt)("p",null,"\u8bed\u6cd5\u6811\u9664\u4e86\u5305\u542b\u524d\u9762\u5df2\u7ecf\u586b\u5145\u597d\u7684\u8bed\u6cd5\u6811\u5b50\u8282\u70b9 List\uff0c\u8fd8\u5305\u542b\u4f5c\u7528\u57df Scope\u3001\u5305\u7b26\u53f7\u3001Type \u7b49\u5c5e\u6027\uff0c\u7b26\u53f7\u8868\u7684\u586b\u5145\u4e5f\u5c31\u662f\u586b\u5145\u8bed\u6cd5\u6811\u4e2d\u7684\u8fd9\u4e9b\u8fd8\u672a\u586b\u5145\u7684\u5c5e\u6027"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210609231646204",src:t(12629).Z,width:"805",height:"301"})),(0,o.kt)("p",null,"\u7b26\u53f7\u8868\u586b\u5145\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a"),(0,o.kt)("img",{src:"https://www.plantuml.com/plantuml/png/fLHDQnD16BxFhvXR3sKBzkXXAOIABHOAJK-U9fktPd1sTfcP3UJcmM3KGcom1UsbNaHeguXWYal_JMPN_uMpdzcFM4HFi_C-pxnVp_lkbbH4gC1b23ssRBnBXgJZkJvb8DRNxsCd-qPLksKtMC0LYAu0a0tUTW8OWaieH-bbQKjTCr20q1hMRqv-VhcElfr65oUBc-je7kfN5_fu74tEugzXVFLHJ-Sj1_Ss74QaJEy5kDl9eXD5FNx8gKg8n770LwY5OLDmwMr89LLTpty4Gs0cfL_FPlfsfYVdElnXCgddS31o5UaLfUyJvobv0aY02WHFw_bmgSVZ5fjHgNBodjSFc6bOXbbsRZRNdiUIbe7R0o5HpTwcbKriy3f9PnvGta-BAraLSvDpH1dRuIRtwELbD9t6Rpz5atby_bdVdYvkNiVldniXehCNY_3xNLwaG_YXJ5gY1l8lmjt1eDnXGHzoevb1qzPKZUL4r5xNDKcXGf5_FL1pvYe3j_f1SURlqYnAiV3cHbs9Ggtko8VsNgpXE7nNhaKsKdZ7zJsX3XpF1rG-CuESsUN-W4YeUjdcGsdP8k0fql1fLiq8Mqab3wACOsmGB0FVR7PoqxDZJ9DOHyGnOriDPzaFAGWYdC5ePNXKXmqTY57i3zmbPjbxsHAiPlwlkAN6Q0jut_m1VmC0",alt:null}),(0,o.kt)("p",null,"\u4e24\u4e2a\u9636\u6bb5"),(0,o.kt)("p",null,"\u7b26\u53f7\u8868\u7684\u586b\u5145\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u8fc7\u7a0b\uff1a"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"\u586b\u5145\u5305\u7b26\u53f7\uff0c\u5e76\u521b\u5efa\u7c7b\u7b26\u53f7\u672c\u8eab\uff0c\u5bf9\u4e8e\u7c7b\u7b26\u53f7\u5185\u90e8\u7684\u65b9\u6cd5\u3001\u6210\u5458\u5c5e\u6027\uff0c\u4f1a\u5728\u4e0b\u4e00\u4e2a\u9636\u6bb5\u586b\u5145"),(0,o.kt)("li",{parentName:"ul"},"\u586b\u5145 ImportScope\u3001type \u548c\u7236\u7c7b\u578b\u4ee5\u53ca\u63a5\u53e3\u3001\u6210\u5458\u5c5e\u6027\u3001\u6210\u5458\u65b9\u6cd5"))),(0,o.kt)("p",null,"\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\u4e3b\u8981\u7531 ",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.comp.Enter"),"\u3001",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.comp.TypeEnter"),"\u3001",(0,o.kt)("inlineCode",{parentName:"p"},"com.sun.tools.javac.comp.MemberEnter"),"\u7c7b\u6765\u5b8c\u6210\u3002"),(0,o.kt)("p",null,"\u7a0b\u5e8f\u9996\u5148\u4f1a\u8fdb\u5165\u5230 ",(0,o.kt)("inlineCode",{parentName:"p"},"Enter#complete()")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"\n    /** Main method: enter classes from the list of toplevel trees, possibly\n     *  skipping TypeEnter for all but 'c' by placing them on the uncompleted\n     *  list.\n     *  @param trees      The list of trees to be processed.\n     *  @param c          The class symbol to be processed or null to process all.\n     */\n    public void complete(List<JCCompilationUnit> trees, ClassSymbol c) {\n        annotate.blockAnnotations();\n        ListBuffer<ClassSymbol> prevUncompleted = uncompleted;\n        if (typeEnter.completionEnabled) uncompleted = new ListBuffer<>();\n\n        try {\n            // enter all classes, and construct uncompleted list\n            // \u9636\u6bb51\n            classEnter(trees, null);\n\n            // complete all uncompleted classes in memberEnter\n            if (typeEnter.completionEnabled) {\n                while (uncompleted.nonEmpty()) {\n                    ClassSymbol clazz = uncompleted.next();\n                    if (c == null || c == clazz || prevUncompleted == null)\n                        // \u9636\u6bb52\n                        clazz.complete();\n                    else\n                        // defer\n                        prevUncompleted.append(clazz);\n                }\n\n                if (!modules.modulesInitialized()) {\n                    for (JCCompilationUnit cut : trees) {\n                        if (cut.getModuleDecl() != null) {\n                            unfinishedModules.append(cut);\n                        } else {\n                            typeEnter.ensureImportsChecked(List.of(cut));\n                        }\n                    }\n                } else {\n                    typeEnter.ensureImportsChecked(unfinishedModules.toList());\n                    unfinishedModules.clear();\n                    typeEnter.ensureImportsChecked(trees);\n                }\n            }\n        } finally {\n            uncompleted = prevUncompleted;\n            annotate.unblockAnnotations();\n        }\n    }\n\n")),(0,o.kt)("p",null,"\u8fdb\u884c\u9636\u6bb5 1 \u524d\uff0c\u8bed\u6cd5\u6811\u586b\u5145\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210609231646204",src:t(12629).Z,width:"805",height:"301"})),(0,o.kt)("p",null,"\u8fdb\u884c\u9636\u6bb5 2 \u524d\uff0c\u8bed\u6cd5\u6811\u586b\u5145\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210609233156958",src:t(83079).Z,width:"790",height:"379"})),(0,o.kt)("p",null,"\u5b8c\u6210\u9636\u6bb5 2 \u540e\uff0c\u8bed\u6cd5\u6811\u586b\u5145\u60c5\u51b5\u5982\u4e0b\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210609233506776",src:t(98506).Z,width:"1013",height:"562"})),(0,o.kt)("p",null,"\uff081\uff09\u9636\u6bb5 1\uff1a\u521b\u5efa\u5305\u6216\u7c7b\u7b26\u53f7"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'public class Enter extends JCTree.Visitor {\n        @Override\n    public void visitTopLevel(JCCompilationUnit tree) {\n        // Assert.checkNonNull(tree.modle, tree.sourcefile.toString());\n\n        JavaFileObject prev = log.useSource(tree.sourcefile);\n        boolean addEnv = false;\n        boolean isPkgInfo = tree.sourcefile.isNameCompatible("package-info",\n                                                             JavaFileObject.Kind.SOURCE);\n        if (TreeInfo.isModuleInfo(tree)) {\n            JCPackageDecl pd = tree.getPackage();\n            if (pd != null) {\n                log.error(pd.pos(), Errors.NoPkgInModuleInfoJava);\n            }\n            tree.packge = syms.rootPackage;\n            Env<AttrContext> topEnv = topLevelEnv(tree);\n            classEnter(tree.defs, topEnv);\n            tree.modle.usesProvidesCompleter = modules.getUsesProvidesCompleter();\n        } else {\n            JCPackageDecl pd = tree.getPackage();\n            if (pd != null) {\n                // 1.\u9012\u5f52\u521b\u5efa\u5305\u7b26\u53f7\n                tree.packge = pd.packge = syms.enterPackage(tree.modle, TreeInfo.fullName(pd.pid));\n                if (   pd.annotations.nonEmpty()\n                    || pkginfoOpt == PkgInfo.ALWAYS\n                    || tree.docComments != null) {\n                    if (isPkgInfo) {\n                        addEnv = true;\n                    } else if (pd.annotations.nonEmpty()) {\n                        log.error(pd.annotations.head.pos(),\n                                  Errors.PkgAnnotationsSbInPackageInfoJava);\n                    }\n                }\n            } else {\n                tree.packge = tree.modle.unnamedPackage;\n            }\n\n            Map<Name, PackageSymbol> visiblePackages = tree.modle.visiblePackages;\n            Optional<ModuleSymbol> dependencyWithPackage =\n                // 2.\u626b\u63cf\u5305\u4e0b\u7684\u6240\u6709Java\u6e90\u6587\u4ef6\uff0c\u6328\u4e2a\u521b\u5efa\u7c7b\u7b26\u53f7\uff0c\u5e76\u5f62\u6210\u4e00\u4e2a\u7c7b\u7b26\u53f7\u5217\u8868\u4f5c\u4e3a\u5305\u7b26\u53f7\u7684\u6210\u5458\u5c5e\u6027(members_field)\n                syms.listPackageModules(tree.packge.fullname)\n                    .stream()\n                    .filter(m -> m != tree.modle)\n                    .filter(cand -> visiblePackages.get(tree.packge.fullname) == syms.getPackage(cand, tree.packge.fullname))\n                    .findAny();\n\n            if (dependencyWithPackage.isPresent()) {\n                log.error(pd, Errors.PackageInOtherModule(dependencyWithPackage.get()));\n            }\n\n            tree.packge.complete(); // Find all classes in package.\n\n            Env<AttrContext> topEnv = topLevelEnv(tree);\n            Env<AttrContext> packageEnv = isPkgInfo ? topEnv.dup(pd) : null;\n\n            // Save environment of package-info.java file.\n            if (isPkgInfo) {\n                Env<AttrContext> env0 = typeEnvs.get(tree.packge);\n                if (env0 != null) {\n                    JCCompilationUnit tree0 = env0.toplevel;\n                    if (!fileManager.isSameFile(tree.sourcefile, tree0.sourcefile)) {\n                        log.warning(pd != null ? pd.pid.pos() : null,\n                                    Warnings.PkgInfoAlreadySeen(tree.packge));\n                    }\n                }\n                typeEnvs.put(tree.packge, packageEnv);\n\n                for (Symbol q = tree.packge; q != null && q.kind == PCK; q = q.owner)\n                    q.flags_field |= EXISTS;\n\n                Name name = names.package_info;\n                ClassSymbol c = syms.enterClass(tree.modle, name, tree.packge);\n                c.flatname = names.fromString(tree.packge + "." + name);\n                c.sourcefile = tree.sourcefile;\n            c.completer = Completer.NULL_COMPLETER;\n                c.members_field = WriteableScope.create(c);\n                tree.packge.package_info = c;\n                tree.packge.sourcefile = tree.sourcefile;\n            }\n            classEnter(tree.defs, topEnv);\n            if (addEnv) {\n                todo.append(packageEnv);\n            }\n        }\n        log.useSource(prev);\n        result = null;\n    }\n}\n\n')),(0,o.kt)("p",null,"\u521b\u5efa\u5305\u7b26\u53f7\u548c\u7c7b\u7b26\u53f7\u7684\u521b\u5efa\u90fd\u662f\u7531",(0,o.kt)("inlineCode",{parentName:"p"},"Symtab"),"\u5b8c\u6210\u7684:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'public class Symtab {\n    private final Map<Name, Map<ModuleSymbol,ClassSymbol>> classes = new HashMap<>();\n    private final Map<Name, Map<ModuleSymbol,PackageSymbol>> packages = new HashMap<>();\n\n    /** Make a package, given its fully qualified name.\n     */\n    public PackageSymbol enterPackage(ModuleSymbol currModule, Name fullname) {\n        Assert.checkNonNull(currModule);\n        PackageSymbol p = getPackage(currModule, fullname);\n        if (p == null) {\n            // \u82e5\u6ca1\u6709\u521b\u5efa\u8fc7\uff0c\u5219\u521b\u5efa\u5e76\u653e\u5165\u5230\u7f13\u5b58\u4e2d\n            Assert.check(!fullname.isEmpty(), () -> "rootPackage missing!; currModule: " + currModule);\n            p = new PackageSymbol(\n                    // shortName\u5f53\u524d\u5305\u7b80\u79f0\uff0c packagePart\u4e3a\u5f53\u524d\u5305\u7684\u7236\u7ea7\u5305\u540d\uff0c\u4e5f\u5c31\u662f\u8bf4\u521b\u5efa\u5f53\u524d\u5305\u7b26\u53f7\u7684\u65f6\u5019\u4f1a\u9012\u5f52\u521b\u5efa\u5176\u7236\u5305\u7b26\u53f7\n                    // \u5f53\u6b64\u5305\u4e3a\u4e00\u7ea7\u5305\u65f6\uff0c\u5176\u7236\u5305\u4e3a rootPackage\uff0cpackagePart\u503c\u4e3a\u7a7a\u4e32\n                    Convert.shortName(fullname),\n                    enterPackage(currModule, Convert.packagePart(fullname)));\n            p.completer = initialCompleter;\n            p.modle = currModule;\n            doEnterPackage(currModule, p);\n        }\n        return p;\n    }\n\n    private void doEnterPackage(ModuleSymbol msym, PackageSymbol pack) {\n        packages.computeIfAbsent(pack.fullname, n -> new HashMap<>()).put(msym, pack);\n        msym.enclosedPackages = msym.enclosedPackages.prepend(pack);\n    }\n\n    public PackageSymbol getPackage(ModuleSymbol module, Name fullname) {\n        return packages.getOrDefault(fullname, Collections.emptyMap()).get(module);\n    }\n\n\n\n    /** Create a new toplevel or member class symbol with given name\n     *  and owner and enter in `classes\' unless already there.\n     */\n    public ClassSymbol enterClass(ModuleSymbol msym, Name name, TypeSymbol owner) {\n        Assert.checkNonNull(msym);\n        Name flatname = TypeSymbol.formFlatName(name, owner);\n        ClassSymbol c = getClass(msym, flatname);\n        if (c == null) {\n            // \u82e5\u6ca1\u6709\u521b\u5efa\u8fc7\uff0c\u5219\u521b\u5efa\u5e76\u653e\u5165\u5230\u7f13\u5b58\u4e2d\n            // \u521b\u5efa\u7c7b\u7b26\u53f7\u7684\u65f6\u5019\uff0c\u6b64\u7c7b\u7b26\u53f7\u7684Owner\u4e3a\u5305\u7b26\u53f7\n            c = defineClass(name, owner);\n            doEnterClass(msym, c);\n        } else if ((c.name != name || c.owner != owner) && owner.kind == TYP && c.owner.kind == PCK) {\n            // reassign fields of classes that might have been loaded with\n            // their flat names.\n            c.owner.members().remove(c);\n            c.name = name;\n            c.owner = owner;\n            c.fullname = ClassSymbol.formFullName(name, owner);\n        }\n        return c;\n    }\n\n    private void doEnterClass(ModuleSymbol msym, ClassSymbol cs) {\n        classes.computeIfAbsent(cs.flatname, n -> new HashMap<>()).put(msym, cs);\n    }\n\n    public ClassSymbol defineClass(Name name, Symbol owner) {\n        ClassSymbol c = new ClassSymbol(0, name, owner);\n        c.completer = initialCompleter;\n        return c;\n    }\n\n}\n')),(0,o.kt)("p",null,"\u521b\u5efa\u597d\u5305\u7b26\u53f7\u4e4b\u540e\uff0c\u4f1a\u586b\u5145\u5305\u7b26\u53f7\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"members_field")," \u5c5e\u6027\uff0c\u5305\u7b26\u53f7\u7684 Member \u5373\u4e3a\u7c7b\u7b26\u53f7\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"public class Symtab {\n    public List<ModuleSymbol> listPackageModules(Name packageName) {\n        if (packageName.isEmpty())\n            return List.nil();\n\n        List<ModuleSymbol> result = List.nil();\n        Map<ModuleSymbol,PackageSymbol> map = packages.get(packageName);\n        if (map != null) {\n            for (Map.Entry<ModuleSymbol, PackageSymbol> e: map.entrySet()) {\n                // \u8c03\u7528PackageSymbol#members() \u4f1a\u586b\u5145\u5305\u7b26\u53f7\u7684Member\n                if (!e.getValue().members().isEmpty()) {\n                    result = result.prepend(e.getKey());\n                }\n            }\n        }\n        return result;\n    }\n\n}\n\npublic abstract class Symbol extends AnnoConstruct implements PoolConstant, Element {\n\n    public WriteableScope members() {\n        complete();\n        return members_field;\n    }\n\n    /** Complete the elaboration of this symbol's definition.\n     */\n    public void complete() throws CompletionFailure {\n        if (completer != Completer.NULL_COMPLETER) {\n            Completer c = completer;\n            completer = Completer.NULL_COMPLETER;\n            // completer \u4e3a ClassFinder\n            c.complete(this);\n        }\n    }\n}\n")),(0,o.kt)("p",null,"\u8fdb\u5165\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"ClassFinder#complete()"),"\u4e4b\u540e\uff0c\u7531\u4e8e sym \u662f PackageSymbol\uff0c\u56e0\u6b64\u4f1a\u8fdb\u5165\u5230",(0,o.kt)("inlineCode",{parentName:"p"},"ClassFinder#fillIn(PackageSymbol p)"),"\uff0c\u5728\u6b64\u65b9\u6cd5\u4e2d\uff0c\u4f1a\u5728\u7528\u6237\u76ee\u5f55\u4e0b\u626b\u63cf\u6307\u5b9a\u5305\u4e0b\u7684 Java \u6e90\u6587\u4ef6"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'public class ClassFinder {\n    /** Completion for classes to be loaded. Before a class is loaded\n     *  we make sure its enclosing class (if any) is loaded.\n     */\n    private void complete(Symbol sym) throws CompletionFailure {\n        if (sym.kind == TYP) {\n            // \u586b\u5145\u7c7b\u7b26\u53f7\n            try {\n                ClassSymbol c = (ClassSymbol) sym;\n                dependencies.push(c, CompletionCause.CLASS_READER);\n                annotate.blockAnnotations();\n                c.members_field = new Scope.ErrorScope(c); // make sure it\'s always defined\n                completeOwners(c.owner);\n                completeEnclosing(c);\n                fillIn(c);\n            } finally {\n                annotate.unblockAnnotationsNoFlush();\n                dependencies.pop();\n            }\n        } else if (sym.kind == PCK) {\n            PackageSymbol p = (PackageSymbol)sym;\n            try {\n                fillIn(p);\n            } catch (IOException ex) {\n                throw new CompletionFailure(\n                        sym,\n                        () -> diagFactory.fragment(\n                            Fragments.ExceptionMessage(ex.getLocalizedMessage())),\n                        dcfh)\n                    .initCause(ex);\n            }\n        }\n        if (!reader.filling)\n            annotate.flush(); // finish attaching annotations\n    }\n\n    /** Load directory of package into members scope.\n     */\n    private void fillIn(PackageSymbol p) throws IOException {\n        if (p.members_field == null)\n            p.members_field = WriteableScope.create(p);\n\n        ModuleSymbol msym = p.modle;\n\n        Assert.checkNonNull(msym, p::toString);\n\n        msym.complete();\n\n        if (msym == syms.noModule) {\n            preferCurrent = false;\n            if (userPathsFirst) {\n                scanUserPaths(p, true);\n                preferCurrent = true;\n                scanPlatformPath(p);\n            } else {\n                scanPlatformPath(p);\n                scanUserPaths(p, true);\n            }\n        } else if (msym.classLocation == StandardLocation.CLASS_PATH) {\n            // \u5728\u7528\u6237\u76ee\u5f55\u4e0b\u626b\u63cf\u6307\u5b9a\u5305\u4e0b\u7684Java\u6e90\u6587\u4ef6\n            scanUserPaths(p, msym.sourceLocation == StandardLocation.SOURCE_PATH);\n        } else {\n            scanModulePaths(p, msym);\n        }\n    }\n\n        /**\n     * Scans class path and source path for files in given package.\n     */\n    private void scanUserPaths(PackageSymbol p, boolean includeSourcePath) throws IOException {\n        ...\n        if (wantSourceFiles)\n            // \u6839\u636e\u6e90\u6587\u4ef6\u521b\u5efa\u7c7b\u7b26\u53f7\u5e76\u586b\u5145\u81f3\u5305\u7b26\u53f7\n            fillIn(p, SOURCE_PATH,\n                    // \u83b7\u53d6\u5305\u8def\u5f84\u4e0b\u7684\u6240\u6709Java\u6e90\u6587\u4ef6\n                    list(SOURCE_PATH,\n                        p,\n                        packageName,\n                        sourceKinds));\n        ...\n    }\n\n    private void fillIn(PackageSymbol p,\n                            Location location,\n                            Iterable<JavaFileObject> files){\n            currentLoc = location;\n            for (JavaFileObject fo : files) {\n                switch (fo.getKind()) {\n                case OTHER:\n                    extraFileActions(p, fo);\n                    break;\n                case CLASS:\n                case SOURCE: {\n                    // TODO pass binaryName to includeClassFile\n                    String binaryName = fileManager.inferBinaryName(currentLoc, fo);\n                    String simpleName = binaryName.substring(binaryName.lastIndexOf(".") + 1);\n                    if (SourceVersion.isIdentifier(simpleName) ||\n                        simpleName.equals("package-info"))\n                        // \u6839\u636e\u6e90\u6587\u4ef6\u521b\u5efa\u7c7b\u7b26\u53f7\u5e76\u586b\u5145\u81f3\u5305\u7b26\u53f7\n                        includeClassFile(p, fo);\n                    break;\n                }\n                default:\n                    extraFileActions(p, fo);\n                    break;\n                }\n            }\n    }\n\n    protected void includeClassFile(PackageSymbol p, JavaFileObject file) {\n        ...\n        Name classname = names.fromString(binaryName.substring(lastDot + 1));\n        boolean isPkgInfo = classname == names.package_info;\n        ClassSymbol c = isPkgInfo\n            ? p.package_info\n            : (ClassSymbol) p.members_field.findFirst(classname);\n        if (c == null) {\n            // \u521b\u5efa\u7c7b\u7b26\u53f7\n            c = syms.enterClass(p.modle, classname, p);\n            if (c.classfile == null) // only update the file if\'s it\'s newly created\n                c.classfile = file;\n            if (isPkgInfo) {\n                p.package_info = c;\n            } else {\n                if (c.owner == p)  // it might be an inner class\n                    // \u5c06\u7c7b\u7b26\u53f7\u586b\u5145\u8fdb\u5305\u7b26\u53f7\u7684 members_field\n                    p.members_field.enter(c);\n            }\n        }\n        ...\n    }\n}\n')),(0,o.kt)("p",null,"\uff082\uff09\u9636\u6bb5 2\uff1a\u586b\u5145\u7c7b\u7b26\u53f7\u4e0b\u7684\u5c5e\u6027"),(0,o.kt)("p",null,"\u7ed9\u8bed\u6cd5\u6811\u586b\u5145\u597d\u4e86\u5305\u7b26\u53f7\uff0c\u548c\u7c7b\u7b26\u53f7\u672c\u8eab\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u7ee7\u7eed\u586b\u5145\u7c7b\u7b26\u53f7\u7684\u5c5e\u6027\n\u6b64\u9636\u6bb5\u4e3b\u8981\u662f\u7531",(0,o.kt)("inlineCode",{parentName:"p"},"TypeEnter#complete()"),"\u5f00\u59cb\uff0c\u5e76\u4f1a\u7ecf\u5386\u4e00\u7cfb\u5217\u9636\u6bb5"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"// \u8fdb\u5165\u7c7b\u578b\u4f5c\u7528\u57df\npublic class TypeEnter implements Completer {\n    private final ImportsPhase completeClass = new ImportsPhase();\n\n    @Override\n    public void complete(Symbol sym) throws CompletionFailure {\n        ...\n        List<Env<AttrContext>> queue;\n\n        dependencies.push((ClassSymbol) sym, CompletionCause.MEMBER_ENTER);\n        try {\n            // \u5f00\u59cb\u5206\u9636\u6bb5\u586b\u5145\u7c7b\u7b26\u53f7\u7684 extend/implement/typeParam/member \u7b49\u5c5e\u6027\n            queue = completeClass.completeEnvs(List.of(typeEnvs.get((ClassSymbol) sym)));\n        } finally {\n            dependencies.pop();\n        }\n        ...\n    }\n}\n\n")),(0,o.kt)("p",null,"TypeEnter \u7684\u9636\u6bb5\u7531",(0,o.kt)("inlineCode",{parentName:"p"},"Phase"),"\u8868\u793a\uff0c\u4f7f\u7528\u5355\u94fe\u8868\u4f5c\u4e3a\u5176\u6570\u636e\u7ed3\u6784\u5373\u53ef\u5c06\u4e00\u7cfb\u5217\u9636\u6bb5\u4e32\u8054\u8d77\u6765\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"abstract class Phase {\n    private final ListBuffer<Env<AttrContext>> queue = new ListBuffer<>();\n    private final Phase next;\n    private final CompletionCause phaseName;\n\n    Phase(CompletionCause phaseName, Phase next) {\n        this.phaseName = phaseName;\n        this.next = next;\n    }\n\n    public final List<Env<AttrContext>> completeEnvs(List<Env<AttrContext>> envs) {\n        boolean firstToComplete = queue.isEmpty();\n\n        Phase prevTopLevelPhase = topLevelPhase;\n        boolean success = false;\n\n        try {\n            topLevelPhase = this;\n            // \u6267\u884c\u5f53\u524d\u8282\u70b9\u4ee3\u8868\u7684\u9636\u6bb5\n            doCompleteEnvs(envs);\n            success = true;\n        } finally {\n            topLevelPhase = prevTopLevelPhase;\n            if (!success && firstToComplete) {\n                //an exception was thrown, e.g. BreakAttr:\n                //the queue would become stale, clear it:\n                queue.clear();\n            }\n        }\n\n        if (firstToComplete) {\n            List<Env<AttrContext>> out = queue.toList();\n\n            queue.clear();\n            // \u6267\u884c\u540e\u7ee7\u8282\u70b9\u4ee3\u8868\u7684\u9636\u6bb5\uff0c\u4e5f\u5373\u4e0b\u4e00\u4e2a\u9636\u6bb5\n            return next != null ? next.completeEnvs(out) : out;\n        } else {\n            return List.nil();\n        }\n    }\n\n    protected void doCompleteEnvs(List<Env<AttrContext>> envs) {\n        for (Env<AttrContext> env : envs) {\n            JCClassDecl tree = (JCClassDecl)env.tree;\n\n            queue.add(env);\n\n            JavaFileObject prev = log.useSource(env.toplevel.sourcefile);\n            DiagnosticPosition prevLintPos = deferredLintHandler.setPos(tree.pos());\n            try {\n                dependencies.push(env.enclClass.sym, phaseName);\n                // \u6267\u884c\u6b64\u9636\u6bb5\u7684\u5177\u4f53\u4efb\u52a1\n                runPhase(env);\n            } catch (CompletionFailure ex) {\n                chk.completionError(tree.pos(), ex);\n            } finally {\n                dependencies.pop();\n                deferredLintHandler.setPos(prevLintPos);\n                log.useSource(prev);\n            }\n        }\n    }\n\n    protected abstract void runPhase(Env<AttrContext> env);\n}\n")),(0,o.kt)("p",null,"\u4e3b\u8981\u7684\u9636\u6bb5\u6709\uff1a"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"ImportsPhase: \u8865\u5145 import \u4fe1\u606f\uff0c\u586b\u5145\u7f16\u8bd1\u5355\u5143\u7684 namedImportScope \u548c starImportScope \u5c5e\u6027\uff0c\u540c\u65f6\u586b\u5145\u5b50\u8282\u70b9 JCImport \u7684 importScope \u5c5e\u6027"),(0,o.kt)("li",{parentName:"ul"},"HierarchyPhase: \u8865\u5145\u7c7b\u5c42\u7ea7\u4fe1\u606f\uff0c\u586b\u5145 JCClassDecl \u7684 extending \u548c implementing \u4ee5\u53ca sym \u5c5e\u6027\u7684 supertype_field\uff08\u7236\u7c7b\uff09\u3001interfaces_field\uff08\u63a5\u53e3\uff09"),(0,o.kt)("li",{parentName:"ul"},"HeaderPhase: \u586b\u5145 JCModifiers \u4e0b\u7684\u6ce8\u89e3"),(0,o.kt)("li",{parentName:"ul"},"MembersPhase: \u586b\u5145 JCVariableDecl \u4e0b\u7684"))),(0,o.kt)("p",null,"ImportsPhase\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"private final class ImportsPhase extends Phase {\n    @Override\n    protected void runPhase(Env<AttrContext> env) {\n        ...\n        resolveImports(env.toplevel, env.enclosing(TOPLEVEL));\n        ...\n    }\n\n    private void resolveImports(JCCompilationUnit tree, Env<AttrContext> env) {\n        ....\n        // \u4f7f\u7528 java.Lang \u5305\u6765\u586b\u5145\u7f16\u8bd1\u5355\u5143\u7684startImportScope\n        importAll(make.at(tree.pos()).Import(make.QualIdent(javaLang), false), javaLang, env);\n\n        JCModuleDecl decl = tree.getModuleDecl();\n\n        // Process the package def and all import clauses.\n        if (tree.getPackage() != null && decl == null)\n            checkClassPackageClash(tree.getPackage());\n\n        for (JCImport imp : tree.getImports()) {\n            // \u4f7f\u7528\u7c7b\u4e2d\u7684Import\u8bed\u53e5\u6765\u586b\u5145\u7f16\u8bd1\u5355\u5143\u7684namedImport\uff0c\u540c\u65f6\u4e5f\u4f1a\u586b\u5145\u5176\u5b50\u8282\u70b9JCImport\u7684ImportScope\n            doImport(imp);\n        }\n        ...\n    }\n\n    private void doImport(JCImport tree) {\n        ...\n        // Named type import.\n        if (tree.staticImport) {\n            importNamedStatic(tree, p, name, localEnv);\n            chk.checkCanonical(imp.selected);\n        } else {\n            Type importedType = attribImportType(imp, localEnv);\n            Type originalType = importedType.getOriginalType();\n            TypeSymbol c = originalType.hasTag(CLASS) ? originalType.tsym : importedType.tsym;\n            chk.checkCanonical(imp);\n            importNamed(tree.pos(), c, env, tree);\n        }\n        ...\n    }\n\n    // \u5411\u8bed\u6cd5\u6811\u4e2d\u586b\u5145import\u4fe1\u606f\n    private void importNamed(DiagnosticPosition pos, final Symbol tsym, Env<AttrContext> env, JCImport imp) {\n        if (tsym.kind == TYP)\n            imp.importScope = env.toplevel.namedImportScope.importType(tsym.owner.members(), tsym.owner.members(), tsym);\n    }\n}\n")),(0,o.kt)("p",null,"\u5982\u4e0b\u56fe\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210610155908948",src:t(54718).Z,width:"1014",height:"439"})),(0,o.kt)("p",null,"HierarchyPhase\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210610161852504",src:t(27798).Z,width:"772",height:"698"})),(0,o.kt)("p",null,"HeaderPhase\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210610162609219",src:t(34090).Z,width:"632",height:"162"})),(0,o.kt)("p",null,"MembersPhase\uff1a\u586b\u5145\u6210\u5458\u5c5e\u6027\uff1a"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"image-20210610164119822",src:t(20571).Z,width:"687",height:"197"})),(0,o.kt)("h3",{id:"2\u6ce8\u89e3\u5904\u7406"},"2.\u6ce8\u89e3\u5904\u7406"),(0,o.kt)("h4",{id:"21-\u6ce8\u89e3\u5904\u7406\u65f6\u5e8f\u56fe"},"2.1 \u6ce8\u89e3\u5904\u7406\u65f6\u5e8f\u56fe"),(0,o.kt)("img",{src:"https://www.plantuml.com/plantuml/png/hLLDRy8m3BtdL_Is0rebkjiE4zN4OTEG41nt2ec7Wb87EMcd_VibX7weGr3QdLBPxpsxjkCihEFaoaAppyUNvC0hBj8LLpYRFIU5FrbhQlp1te24AOvA0-kv4ez-zwRNwAOkb3qaypHHgDoQZ01hSqJZk5C6BUkIBedCqpk8uenJk5zYfSXW0UY2Z8LQmr3aNiRULkgaO-ZD0N5dQBHYkWMgb81QADODhQDINDVjCqESi-d3S1chf_qN8t0buTN3joXBa-FzxSdIuzJMIDEwnjTnOqgKCQFvq0gUE4DrlnJApa-k2QptJvKFPIeTjC9RYFCgEB8xUID3SIdxpHiJTAaXW6oGt8FBjMvnAqNKtBiQU1hOds9dz3LAHFp1RlXtxXofdS_7iY4ZtXjuzY-ZbYLKuiGPEDq1POMfW7AKcn83RDgI4bphPadTK6fmWNY-pGDtnbDQB_divgPeW4q75e3IlqI_",alt:null}),(0,o.kt)("p",null,"\u6ce8\u89e3\u5904\u7406\u7684\u5165\u53e3\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"public class JavaCompiler {\n /**\n     * Main method: compile a list of files, return all compiled classes\n     *\n     * @param sourceFileObjects file objects to be compiled\n     * @param classnames class names to process for annotations\n     * @param processors user provided annotation processors to bypass\n     * discovery, {@code null} means that no processors were provided\n     * @param addModules additional root modules to be used during\n     * module resolution.\n     */\n    public void compile(Collection<JavaFileObject> sourceFileObjects,\n                        Collection<String> classnames,\n                        Iterable<? extends Processor> processors,\n                        Collection<String> addModules)\n    {\n        ...\n        // \u51c6\u5907\u8fc7\u7a0b\uff1a\u521d\u59cb\u5316\u63d2\u5165\u5f0f\u6ce8\u89e3\u5904\u7406\u5668\uff0c\u6700\u7ec8\u662f\u901a\u8fc7ServiceLoader\u83b7\u53d6\u6240\u6709Processor.class\u7684\u5b9e\u73b0\u7c7b\n        initProcessAnnotations(processors, sourceFileObjects, classnames);\n\n        // These method calls must be chained to avoid memory leaks\n        // 2. \u6267\u884c\u6ce8\u89e3\u5904\u7406\n        processAnnotations(\n            // 1.2 \u586b\u5145\u7b26\u53f7\u8868\n            enterTrees(\n                    stopIfError(CompileState.ENTER,\n                            initModules(stopIfError(CompileState.ENTER,\n                                // 1.1 \u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\uff0c\u4ece\u800c\u6784\u5efa\u51fa\u4e00\u68f5AST\u62bd\u8c61\u8bed\u6cd5\u6811\uff0csourceFileObjects\u5373\u4e3aJava\u6e90\u6587\u4ef6\u5728\u5185\u5b58\u4e2d\u7684\u8868\u793a\n                                parseFiles(sourceFileObjects))))\n            ),\n            classnames\n        );\n        ...\n\n        if (!CompileState.ATTR.isAfter(shouldStopPolicyIfNoError)) {\n            switch (compilePolicy) {\n            ...\n            case BY_TODO:\n                while (!todo.isEmpty())\n                    // 3.\u8bed\u4e49\u5206\u6790\u53ca\u5b57\u8282\u7801\u751f\u6210\n                    generate(desugar(flow(attribute(todo.remove()))));\n                break;\n            ...\n        }\n}\n")),(0,o.kt)("h4",{id:"22-\u83b7\u53d6\u6ce8\u89e3\u5904\u7406\u5668"},"2.2 \u83b7\u53d6\u6ce8\u89e3\u5904\u7406\u5668"),(0,o.kt)("p",null,"\uff081\uff09\u901a\u8fc7 ServiceLoader \u6765\u52a0\u8f7d Processor.class \u7684\u5b9e\u73b0\u7c7b"),(0,o.kt)("p",null,"\u5982\u4e0a\u8ff0\u6d41\u7a0b\u56fe\u6240\u793a\uff0c\u5728",(0,o.kt)("inlineCode",{parentName:"p"},"JavacProcessingEnvironment.ServiceIterator"),"\u7684\u6784\u9020\u65b9\u6cd5\u4e2d\uff0c\u4f1a\u901a\u8fc7 ServiceLoader \u6765\u52a0\u8f7d Processor.class \u7684\u5b9e\u73b0\u7c7b\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u83b7\u53d6\u5230\u6240\u6709\u7684\u6ce8\u89e3\u5904\u7406\u5668\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'private class ServiceIterator implements Iterator<Processor> {\n    private Iterator<Processor> iterator;\n    private Log log;\n    private ServiceLoader<Processor> loader;\n\n    ServiceIterator(ClassLoader var2, Log var3) {\n        this.log = var3;\n\n        try {\n            try {\n                // \u901a\u8fc7 ServiceLoader \u6765\u52a0\u8f7d Processor.class \u7684\u5b9e\u73b0\u7c7b\n                this.loader = ServiceLoader.load(Processor.class, var2);\n                this.iterator = this.loader.iterator();\n            } catch (Exception var5) {\n                this.iterator = JavacProcessingEnvironment.this.handleServiceLoaderUnavailability("proc.no.service", (Exception)null);\n            }\n\n        } catch (Throwable var6) {\n            var3.error("proc.service.problem", new Object[0]);\n            throw new Abort(var6);\n        }\n    }\n}\n\n')),(0,o.kt)("p",null,"\uff082\uff09",(0,o.kt)("inlineCode",{parentName:"p"},"ServiceLoader.load")," \u6839\u636e",(0,o.kt)("inlineCode",{parentName:"p"},"resources/META-INF/services/"),"\u76ee\u5f55\u4e0b\u7684\u63a5\u53e3\u6587\u4ef6\u6765\u53cd\u5c04\u521b\u5efa\u5177\u4f53\u7684\u5b9e\u73b0\u7c7b\u5217\u8868"),(0,o.kt)("h4",{id:"23-\u83b7\u53d6\u6ce8\u89e3\u4e0e\u5904\u7406\u6ce8\u89e3"},"2.3 \u83b7\u53d6\u6ce8\u89e3\u4e0e\u5904\u7406\u6ce8\u89e3"),(0,o.kt)("p",null,"\u83b7\u53d6\u6ce8\u89e3\uff1a"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"\u9996\u5148\u4f1a\u4ece\u8bed\u6cd5\u6811\u4e2d\u83b7\u53d6\u6240\u6709\u7684\u7c7b\u7b26\u53f7"),(0,o.kt)("li",{parentName:"ul"},"\u7136\u540e\u6328\u4e2a\u83b7\u53d6\u6bcf\u4e2a\u7c7b\u7b26\u53f7\u91cc\u7684\u6240\u6709\u7684\u6ce8\u89e3"),(0,o.kt)("li",{parentName:"ul"},"\u83b7\u53d6\u6ce8\u89e3\u7684\u65f6\u5019\u662f\u4ece ClassSymbol.metadata.attributes \u4e2d\u83b7\u53d6"))),(0,o.kt)("p",null,"\u5904\u7406\u6ce8\u89e3\uff1a"),(0,o.kt)("blockquote",null,(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"\u904d\u5386\u6ce8\u89e3\u5904\u7406\u5668\uff0c\u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u6ce8\u89e3\u5904\u7406\u5668\uff0c\u904d\u5386\u6ce8\u89e3\u5217\u8868\uff0c\u82e5\u6709\u6ce8\u89e3\u5339\u914d\u6b64\u6ce8\u89e3\u5904\u7406\u5668\uff0c\u5219\u6ce8\u89e3\u5904\u7406\u5668\u6765\u5904\u7406\u6ce8\u89e3"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"public class JavacProcessingEnvironment implements ProcessingEnvironment, Closeable {\n\n    public boolean doProcessing(List<JCCompilationUnit> roots,\n                                List<ClassSymbol> classSymbols,\n                                Iterable<? extends PackageSymbol> pckSymbols,\n                                Log.DeferredDiagnosticHandler deferredDiagnosticHandler) {\n        // 1.root \u5373\u4e3a\u8bed\u6cd5\u6811\u5217\u8868\uff0c\u8fd9\u91cc\u4f1a\u6839\u636eJCTree \u5217\u8868\u4e2d\u7684\u6240\u6709\u7684\u7c7b\u7b26\u53f7\u83b7\u53d6\u6240\u6709\u6ce8\u89e3\n        Round round = new Round(roots, classSymbols, treesToClean, deferredDiagnosticHandler);\n        boolean errorStatus;\n        boolean moreToDo;\n        do {\n            // Run processors for round n\n            // 2.\u83b7\u53d6\u5230\u6ce8\u89e3\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u6267\u884c\u6ce8\u89e3\u5904\u7406\u5668\n            round.run(false, false);\n\n            // Processors for round n have run to completion.\n            // Check for errors and whether there is more work to do.\n            errorStatus = round.unrecoverableError();\n            moreToDo = moreToDo();\n        } while (moreToDo && !errorStatus);\n\n\n    }\n\n    class Round {\n        List<JCCompilationUnit> roots;\n        Set<TypeElement> annotationsPresent;\n        List<ClassSymbol> topLevelClasses;\n\n        /** Create the first round. */\n        Round(List<JCCompilationUnit> roots,\n              List<ClassSymbol> classSymbols,\n              Set<JCCompilationUnit> treesToClean,\n              Log.DeferredDiagnosticHandler deferredDiagnosticHandler) {\n            this(1, treesToClean, deferredDiagnosticHandler);\n            this.roots = roots;\n            genClassFiles = new HashMap<>();\n\n            // The reverse() in the following line is to maintain behavioural\n            // compatibility with the previous revision of the code. Strictly speaking,\n            // it should not be necessary, but a javah golden file test fails without it.\n             // \u901a\u8fc7\u8bed\u6cd5\u6811\u83b7\u53d6\u6240\u6709\u7684\u7c7b\u7b26\u53f7\n            topLevelClasses =\n                getTopLevelClasses(roots).prependList(classSymbols.reverse());\n\n            packageInfoFiles = getPackageInfoFiles(roots);\n\n            moduleInfoFiles = getModuleInfoFiles(roots);\n      // \u83b7\u53d6\u6240\u6709\u6ce8\u89e3\n            findAnnotationsPresent();\n        }\n\n        /** Find the set of annotations present in the set of top level\n         *  classes and package info files to be processed this round. */\n        void findAnnotationsPresent() {\n            ComputeAnnotationSet annotationComputer = new ComputeAnnotationSet(elementUtils);\n            // Use annotation processing to compute the set of annotations present\n            annotationsPresent = new LinkedHashSet<>();\n            for (ClassSymbol classSym : topLevelClasses)\n                 // \u6328\u4e2a\u626b\u63cf\u6bcf\u4e2a\u7c7b\u7b26\u53f7\uff0c\u627e\u51fa\u5176\u4e2d\u7684\u6ce8\u89e3\uff0c\u6700\u7ec8\u662f\u83b7\u53d6\u4e86 ClassSymbol.metadata.attributes, \u8fd9\u5c31\u662f\u6ce8\u89e3\uff0c\u8fd9\u4e5f\u5c31\u4ece\u4fa7\u9762\u8bf4\u660e\u4e86\u6ce8\u89e3\u662f\u4e00\u79cd\u5143\u6570\u636e\n                annotationComputer.scan(classSym, annotationsPresent);\n            for (PackageSymbol pkgSym : packageInfoFiles)\n                // \u904d\u5386\u6bcf\u4e00\u4e2a package-info.java \u6587\u4ef6\uff0c\u89e3\u6790\u6240\u6709\u7684\u5305\u6ce8\u91ca\n                annotationComputer.scan(pkgSym, annotationsPresent);\n            for (ModuleSymbol mdlSym : moduleInfoFiles)\n                annotationComputer.scan(mdlSym, annotationsPresent);\n        }\n\n        /** Run a processing round. */\n        void run(boolean lastRound, boolean errorStatus) {\n            ...\n            // \u83b7\u53d6\u5e76\u8fd0\u884c\u6ce8\u89e3\u5904\u7406\u5668\n            // annotationsPresent \u4e2d\u5305\u542b\u4e86\u6240\u6709\u6ce8\u89e3\n            discoverAndRunProcs(annotationsPresent, topLevelClasses, packageInfoFiles, moduleInfoFiles);\n            ...\n        }\n    }\n\n    private void discoverAndRunProcs(Set<TypeElement> annotationsPresent,\n                                     List<ClassSymbol> topLevelClasses,\n                                     List<PackageSymbol> packageInfoFiles,\n                                     List<ModuleSymbol> moduleInfoFiles) {\n        // \u5f85\u5339\u914d\u7684\u6ce8\u89e3\u5217\u8868\n        Map<String, TypeElement> unmatchedAnnotations = new HashMap<>(annotationsPresent.size());\n        // \u6ce8\u89e3\u5904\u7406\u5668\u7684\u8fed\u4ee3\u5668\n        DiscoveredProcessors.ProcessorStateIterator psi = discoveredProcs.iterator();\n        ...\n        // \u904d\u5386\u6ce8\u89e3\u5904\u7406\u5668\n        while(unmatchedAnnotations.size() > 0 && psi.hasNext() ) {\n            ProcessorState ps = psi.next();\n            Set<String>  matchedNames = new HashSet<>();\n            Set<TypeElement> typeElements = new LinkedHashSet<>();\n\n             // \u904d\u5386\u6ce8\u89e3\u5217\u8868\n            for (Map.Entry<String, TypeElement> entry: unmatchedAnnotations.entrySet()) {\n                String unmatchedAnnotationName = entry.getKey();\n                // \u5224\u65ad\u6ce8\u89e3\u5904\u7406\u5668\u662f\u5426\u652f\u6301\u6b64\u6ce8\u89e3\n                if (ps.annotationSupported(unmatchedAnnotationName) ) {\n                    matchedNames.add(unmatchedAnnotationName);\n                    TypeElement te = entry.getValue();\n                    if (te != null)\n                        typeElements.add(te);\n                }\n             }\n\n             if (matchedNames.size() > 0 || ps.contributed) {\n                 // \u82e5\u6709\u5339\u914d\u7684\u6ce8\u89e3\uff0c\u5219\u8c03\u7528\u6ce8\u89e3\u5904\u7406\u5668\u53bb\u5904\u7406\u6ce8\u89e3\n                boolean processingResult = callProcessor(ps.processor, typeElements, renv);\n                ps.contributed = true;\n                ps.removeSupportedOptions(unmatchedProcessorOptions);\n                ...\n             }\n        }\n    }\n\n    private boolean callProcessor(Processor proc,\n                                         Set<? extends TypeElement> tes,\n                                         RoundEnvironment renv) {\n        ...\n        return proc.process(tes, renv);\n        ...\n    }\n\n}\n")),(0,o.kt)("h3",{id:"3-\u8bed\u4e49\u5206\u6790\u4e0e\u5b57\u8282\u7801\u751f\u6210"},"3. \u8bed\u4e49\u5206\u6790\u4e0e\u5b57\u8282\u7801\u751f\u6210"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"                    case BY_FILE: {\n                        Queue<Queue<Env<AttrContext>>> q = todo.groupByFile();\n                        while (!q.isEmpty() && !shouldStop(CompileState.ATTR)) {\n                            generate(desugar(flow(attribute(q.remove()))));\n                        }\n                    }\n                    break;\n")))}d.isMDXComponent=!0},36595:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210604145859441-e782b7982e8ec17999cb1af80b8e3d83.png"},48686:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210604193311967-be5037e34bd22cb970dd26ccac9f8dd0.png"},89329:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210604193840324-2a0439886bbbcc3c632d3f7e52dbcfc5.png"},12629:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210609231646204-36d4f638f9d309d93954c41b3567e207.png"},83079:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210609233156958-eb5102dcedc8c55fa51d5a30704356a0.png"},98506:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210609233506776-fe174d077719b77ed94952df06540cbc.png"},54718:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210610155908948-699f450a0c3a4ba0e9735d56f1e99306.png"},27798:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210610161852504-fb6e83fd1f0f50680067c65734d97520.png"},34090:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210610162609219-19b4c7d0759317d22cf5819648e9282d.png"},20571:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210610164119822-dbf53ef7ddfabcf1d491760fde973349.png"},28866:(e,n,t)=>{t.d(n,{Z:()=>a});const a="data:image/png;base64,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"},40538:(e,n,t)=>{t.d(n,{Z:()=>a});const a="data:image/png;base64,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"},82326:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210611215844810-af32caab20c01b910e4bd048c903cb46.png"},41704:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210611215952628-df596691c2c26a15f382a0689b9f25a7.png"},9656:(e,n,t)=>{t.d(n,{Z:()=>a});const a=t.p+"assets/images/image-20210611220155383-2de65e660976b88f54b7220361654f45.png"}}]);